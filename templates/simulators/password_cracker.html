{% extends "base.html" %}

{% block title %}Brute-Force —Å–∏–º—É–ª—è—Ç–æ—Ä - CyberGuardian{% endblock %}

{% block extra_css %}
<style>
.crack-terminal {
    background: #0a0a0a;
    border: 2px solid var(--cyber-primary);
    border-radius: 15px;
    padding: 2rem;
    font-family: 'Courier New', monospace;
    color: var(--cyber-primary);
    min-height: 400px;
    max-height: 500px;
    overflow-y: auto;
    position: relative;
}

.crack-line {
    margin-bottom: 0.5rem;
    animation: typeLine 0.1s ease;
    line-height: 1.4;
}

@keyframes typeLine {
    from { opacity: 0; transform: translateY(5px); }
    to { opacity: 1; transform: translateY(0); }
}

.password-input-container {
    position: relative;
    margin: 2rem 0;
}

.password-input {
    background: rgba(20, 20, 20, 0.8);
    border: 2px solid var(--cyber-border);
    border-radius: 10px;
    color: var(--cyber-primary);
    font-family: 'Courier New', monospace;
    font-size: 1.3rem;
    padding: 1rem 1.5rem;
    width: 100%;
    text-align: center;
    transition: all 0.3s ease;
}

.password-input:focus {
    border-color: var(--cyber-primary);
    box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
    outline: none;
}

.strength-visualization {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 0.5rem;
    margin: 1.5rem 0;
}

.strength-block {
    height: 8px;
    background: var(--cyber-border);
    border-radius: 2px;
    transition: all 0.5s ease;
}

.strength-block.active {
    background: var(--cyber-primary);
    box-shadow: 0 0 10px var(--cyber-primary);
}

.crack-progress {
    height: 6px;
    background: var(--cyber-border);
    border-radius: 3px;
    margin: 1rem 0;
    overflow: hidden;
}

.crack-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #ff4444, #ffaa00, #00ff00);
    width: 0%;
    transition: width 2s ease;
}

.result-card {
    background: rgba(20, 20, 20, 0.9);
    border: 1px solid;
    border-radius: 10px;
    padding: 1.5rem;
    margin-top: 1rem;
}

.result-success {
    border-color: var(--cyber-primary);
    background: rgba(0, 255, 136, 0.1);
}

.result-warning {
    border-color: #ffaa00;
    background: rgba(255, 170, 0, 0.1);
}

.result-danger {
    border-color: #ff4444;
    background: rgba(255, 68, 68, 0.1);
}

.typing-cursor::after {
    content: '‚ñã';
    animation: blink 1s infinite;
}

@keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
}

.attack-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    margin: 1.5rem 0;
}

.stat-box {
    background: rgba(30, 30, 30, 0.8);
    padding: 1rem;
    border-radius: 8px;
    text-align: center;
}

.stat-value {
    font-size: 1.5rem;
    font-weight: bold;
    color: var(--cyber-primary);
}

.stat-label {
    font-size: 0.8rem;
    color: var(--cyber-subtext);
}
</style>
{% endblock %}

{% block content %}
<div class="container">
    <nav class="mb-4">
        <a href="{{ url_for('simulators.simulators_home') }}" class="btn btn-cyber-outline">
            <i class="bi bi-arrow-left me-2"></i>–ù–∞–∑–∞–¥ –∫ —Å–∏–º—É–ª—è—Ç–æ—Ä–∞–º
        </a>
    </nav>

    <div class="row">
        <div class="col-lg-10 mx-auto">
            <div class="cyber-card p-4">
                <div class="text-center mb-4">
                    <h1 class="cyber-text glow-text mb-3">
                        <i class="bi bi-cpu me-2"></i>BRUTE-FORCE –°–ò–ú–£–õ–Ø–¢–û–†
                    </h1>
                    <p class="cyber-subtext">
                        –£–∑–Ω–∞–π—Ç–µ, –∫–∞–∫ –±—ã—Å—Ç—Ä–æ –≤–∑–ª–∞–º—ã–≤–∞—é—Ç—Å—è –ø–∞—Ä–æ–ª–∏. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤–∑–ª–æ–º–∞.
                    </p>
                </div>

                <!-- –í–≤–æ–¥ –ø–∞—Ä–æ–ª—è -->
                <div class="password-input-container">
                    <input type="text" id="passwordInput" class="password-input" 
                           placeholder="–í–í–ï–î–ò–¢–ï –ü–ê–†–û–õ–¨ –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø..." maxlength="30"
                           oninput="updateStrengthMeter(this.value)">
                    <div class="text-center mt-2">
                        <small class="cyber-subtext">üí° –ü–∞—Ä–æ–ª—å –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è</small>
                    </div>
                </div>

                <!-- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ -->
                <div id="strengthMeter" class="strength-visualization" style="display: none;">
                    <div class="strength-block" data-level="1"></div>
                    <div class="strength-block" data-level="2"></div>
                    <div class="strength-block" data-level="3"></div>
                    <div class="strength-block" data-level="4"></div>
                    <div class="strength-block" data-level="5"></div>
                </div>

                <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –≤–∑–ª–æ–º–∞ -->
                <div id="crackProgress" class="crack-progress" style="display: none;">
                    <div class="crack-progress-bar"></div>
                </div>

                <!-- –¢–µ—Ä–º–∏–Ω–∞–ª –≤–∑–ª–æ–º–∞ -->
                <div class="crack-terminal" id="crackTerminal">
                    <div class="crack-line">> [–ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–ò–°–¢–ï–ú–´ BRUTE-FORCE]</div>
                    <div class="crack-line">> –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ–≤–∞—Ä–µ–π... ‚úì</div>
                    <div class="crack-line">> –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è GPU —É—Å–∫–æ—Ä–∏—Ç–µ–ª–µ–π... ‚úì</div>
                    <div class="crack-line">> –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ</div>
                    <div class="crack-line">> –û–ñ–ò–î–ê–ù–ò–ï –í–í–û–î–ê –¶–ï–õ–ò...</div>
                    <div class="crack-line typing-cursor"></div>
                </div>

                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞—Ç–∞–∫–∏ -->
                <div id="attackStats" class="attack-stats" style="display: none;">
                    <div class="stat-box">
                        <div class="stat-value" id="attemptsCount">0</div>
                        <div class="stat-label">–ü–û–ü–´–¢–û–ö</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="speedValue">0</div>
                        <div class="stat-label">–ü–ê–†–û–õ–ï–ô/–°–ï–ö</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="timeValue">0—Å</div>
                        <div class="stat-label">–í–†–ï–ú–Ø</div>
                    </div>
                </div>

                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
                <div id="resultContainer"></div>

                <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ -->
                <div class="text-center mt-4">
                    <button id="crackBtn" class="btn btn-cyber btn-lg" onclick="startCrack()">
                        <i class="bi bi-play-circle me-2"></i>–ó–ê–ü–£–°–¢–ò–¢–¨ –ê–ù–ê–õ–ò–ó
                    </button>
                </div>
            </div>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞—Ä–æ–ª—è—Ö -->
            <div class="cyber-card mt-4">
                <h4 class="cyber-text text-center mb-4">üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ü–ê–†–û–õ–Ø–ú</h4>
                <div class="row">
                    <div class="col-md-6">
                        <div class="result-card result-danger">
                            <h5><i class="bi bi-x-circle me-2"></i>–°–ª–∞–±—ã–µ –ø–∞—Ä–æ–ª–∏</h5>
                            <ul class="cyber-subtext">
                                <li>123456, password, qwerty</li>
                                <li>–î–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è, –∏–º–µ–Ω–∞</li>
                                <li>–ö–æ—Ä–æ—Ç–∫–∏–µ —Å–ª–æ–≤–∞</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="result-card result-success">
                            <h5><i class="bi bi-check-circle me-2"></i>–°–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏</h5>
                            <ul class="cyber-subtext">
                                <li>J8$sK!23pL09@qW</li>
                                <li>–î–ª–∏–Ω–∞ 12+ —Å–∏–º–≤–æ–ª–æ–≤</li>
                                <li>–†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã —Å–∏–º–≤–æ–ª–æ–≤</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function updateStrengthMeter(password) {
    const meter = document.getElementById('strengthMeter');
    const blocks = meter.querySelectorAll('.strength-block');
    
    if (password.length === 0) {
        meter.style.display = 'none';
        return;
    }
    
    meter.style.display = 'grid';
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –±–ª–æ–∫–∏
    blocks.forEach(block => block.classList.remove('active'));
    
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–∏–ª—É –ø–∞—Ä–æ–ª—è
    let strength = 0;
    if (password.length >= 8) strength++;
    if (password.length >= 12) strength++;
    if (/[a-z]/.test(password)) strength++;
    if (/[A-Z]/.test(password)) strength++;
    if (/[0-9]/.test(password)) strength++;
    if (/[^a-zA-Z0-9]/.test(password)) strength++;
    
    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –±–ª–æ–∫–∏
    for (let i = 0; i < Math.min(strength, 5); i++) {
        blocks[i].classList.add('active');
    }
}

function startCrack() {
    const password = document.getElementById('passwordInput').value.trim();
    if (!password) {
        showNotification('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞', 'warning');
        return;
    }

    const terminal = document.getElementById('crackTerminal');
    const crackBtn = document.getElementById('crackBtn');
    const progressBar = document.getElementById('crackProgress');
    const attackStats = document.getElementById('attackStats');
    
    // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
    crackBtn.disabled = true;
    crackBtn.innerHTML = '<div class="spinner-border spinner-border-sm me-2"></div>–í–ó–õ–ê–ú–´–í–ê–ï–ú...';

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    progressBar.style.display = 'block';
    attackStats.style.display = 'grid';

    // –û—á–∏—â–∞–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    terminal.innerHTML = `
        <div class="crack-line">> [–ó–ê–ü–£–°–ö BRUTE-FORCE –ê–¢–ê–ö–ò]</div>
        <div class="crack-line">> –¶–ï–õ–¨: ${'*'.repeat(password.length)}</div>
        <div class="crack-line">> –î–õ–ò–ù–ê: ${password.length} —Å–∏–º–≤–æ–ª–æ–≤</div>
        <div class="crack-line">> –ù–ê–ß–ê–õ–û –ü–ï–†–ï–ë–û–†–ê...</div>
        <div class="crack-line typing-cursor"></div>
    `;

    // –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    let progress = 0;
    const progressInterval = setInterval(() => {
        progress += Math.random() * 10;
        if (progress >= 100) {
            progress = 100;
            clearInterval(progressInterval);
            completeCrack(password);
        }
        document.querySelector('.crack-progress-bar').style.width = progress + '%';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        document.getElementById('attemptsCount').textContent = Math.floor(progress * 1000);
        document.getElementById('speedValue').textContent = Math.floor(5000 + progress * 500);
        document.getElementById('timeValue').textContent = (progress / 20).toFixed(1) + '—Å';
    }, 100);
}

function completeCrack(password) {
    const terminal = document.getElementById('crackTerminal');
    const crackBtn = document.getElementById('crackBtn');
    const resultContainer = document.getElementById('resultContainer');
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    fetch('/simulators/api/crack-password', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({password: password})
    })
    .then(response => response.json())
    .then(data => {
        // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª
        terminal.innerHTML += `
            <div class="crack-line">> –ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–ï–ù</div>
            <div class="crack-line">> –°–õ–û–ñ–ù–û–°–¢–¨: ${data.strength}/5</div>
            <div class="crack-line">> –í–†–ï–ú–Ø –í–ó–õ–û–ú–ê: ${formatTime(data.crack_time)}</div>
            <div class="crack-line">> –†–ï–ó–£–õ–¨–¢–ê–¢: ${data.message}</div>
        `;

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        let resultClass = 'result-danger';
        if (data.strength >= 4) resultClass = 'result-success';
        else if (data.strength >= 3) resultClass = 'result-warning';
        
        resultContainer.innerHTML = `
            <div class="result-card ${resultClass}">
                <h4><i class="bi bi-${data.strength >= 4 ? 'shield-check' : 'shield-exclamation'} me-2"></i>
                    ${data.message}
                </h4>
                <p class="mb-2"><strong>–í—Ä–µ–º—è –≤–∑–ª–æ–º–∞:</strong> ${formatTime(data.crack_time)}</p>
                <p class="mb-0"><strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> ${data.recommendation}</p>
            </div>
        `;

        // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
        crackBtn.disabled = false;
        crackBtn.innerHTML = '<i class="bi bi-arrow-repeat me-2"></i>–ü–†–û–ê–ù–ê–õ–ò–ó–ò–†–û–í–ê–¢–¨ –î–†–£–ì–û–ô';

        // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
        terminal.scrollTop = terminal.scrollHeight;
    });
}

function formatTime(seconds) {
    if (seconds < 1) return '–º–µ–Ω–µ–µ 1 —Å–µ–∫—É–Ω–¥—ã';
    if (seconds < 60) return seconds.toFixed(1) + ' —Å–µ–∫—É–Ω–¥';
    if (seconds < 3600) return Math.round(seconds/60) + ' –º–∏–Ω—É—Ç';
    if (seconds < 86400) return Math.round(seconds/3600) + ' —á–∞—Å–æ–≤';
    return Math.round(seconds/86400) + ' –¥–Ω–µ–π';
}

// Enter –¥–ª—è –∑–∞–ø—É—Å–∫–∞
document.getElementById('passwordInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        startCrack();
    }
});
</script>
{% endblock %}