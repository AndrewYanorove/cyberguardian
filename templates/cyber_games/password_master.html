{% extends "base.html" %}

{% block title %}–ú–∞—Å—Ç–µ—Ä –ø–∞—Ä–æ–ª–µ–π - CyberGuardian{% endblock %}

{% block extra_css %}
<style>
.password-card {
    background: rgba(20, 20, 20, 0.9);
    border: 2px solid var(--cyber-border);
    border-radius: 15px;
    padding: 2rem;
    margin: 1rem 0;
    transition: all 0.3s ease;
}

.password-display {
    font-family: 'Courier New', monospace;
    font-size: 1.5rem;
    font-weight: bold;
    text-align: center;
    padding: 1rem;
    background: rgba(30, 30, 30, 0.8);
    border-radius: 10px;
    margin: 1rem 0;
    border: 1px solid var(--cyber-border);
    letter-spacing: 2px;
    word-break: break-all;
}

.strength-slider {
    width: 100%;
    margin: 2rem 0;
    background: transparent;
}

.strength-meter {
    height: 20px;
    border-radius: 10px;
    background: linear-gradient(90deg, 
        #dc3545 0%, 
        #fd7e14 25%, 
        #ffc107 50%, 
        #20c997 75%, 
        #198754 100%);
    margin: 1rem 0;
    position: relative;
    overflow: hidden;
}

.strength-indicator {
    position: absolute;
    top: -5px;
    width: 10px;
    height: 30px;
    background: white;
    border-radius: 5px;
    transition: left 0.3s ease;
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
    z-index: 2;
}

.strength-labels {
    display: flex;
    justify-content: space-between;
    margin-top: 0.5rem;
    font-size: 0.8rem;
    color: var(--cyber-subtext);
}

.feedback-container {
    background: rgba(30, 30, 30, 0.8);
    border: 1px solid var(--cyber-border);
    border-radius: 10px;
    padding: 1.5rem;
    margin: 1rem 0;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin: 2rem 0;
}

.stat-card {
    background: rgba(30, 30, 30, 0.8);
    border: 1px solid var(--cyber-border);
    border-radius: 10px;
    padding: 1.5rem;
    text-align: center;
    transition: all 0.3s ease;
}

.stat-card:hover {
    border-color: var(--cyber-primary);
    transform: translateY(-2px);
}

.stat-value {
    font-size: 2rem;
    font-weight: bold;
    color: var(--cyber-primary);
}

.stat-label {
    font-size: 0.9rem;
    color: var(--cyber-subtext);
}

.learning-section {
    background: rgba(20, 20, 20, 0.9);
    border: 2px solid var(--cyber-border);
    border-radius: 15px;
    padding: 2rem;
    margin: 2rem 0;
}

.tip-card {
    background: rgba(30, 30, 30, 0.8);
    border: 1px solid var(--cyber-border);
    border-radius: 10px;
    padding: 1.5rem;
    margin: 1rem 0;
    transition: all 0.3s ease;
}

.tip-card:hover {
    border-color: var(--cyber-primary);
    transform: translateX(5px);
}

.tip-card.critical {
    border-left: 4px solid #dc3545;
}

.tip-card.high {
    border-left: 4px solid #fd7e14;
}

.tip-card.medium {
    border-left: 4px solid #ffc107;
}

.tip-icon {
    font-size: 2rem;
    margin-right: 1rem;
    color: var(--cyber-primary);
}

.cracking-method {
    background: rgba(40, 40, 40, 0.8);
    border: 1px solid var(--cyber-border);
    border-radius: 10px;
    padding: 1.5rem;
    margin: 1rem 0;
}

.method-header {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 1rem;
}

.method-speed {
    background: var(--cyber-accent);
    color: white;
    padding: 0.3rem 0.8rem;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: bold;
}

.progress-container {
    background: rgba(30, 30, 30, 0.8);
    border-radius: 10px;
    padding: 1rem;
    margin-bottom: 2rem;
}

.quiz-section {
    background: rgba(20, 20, 20, 0.9);
    border: 2px solid var(--cyber-border);
    border-radius: 15px;
    padding: 2rem;
    margin: 2rem 0;
}

.quiz-question {
    background: rgba(30, 30, 30, 0.8);
    border-radius: 10px;
    padding: 1.5rem;
    margin: 1rem 0;
}

.quiz-option {
    background: rgba(40, 40, 40, 0.8);
    border: 1px solid var(--cyber-border);
    border-radius: 8px;
    padding: 1rem;
    margin: 0.5rem 0;
    cursor: pointer;
    transition: all 0.3s ease;
}

.quiz-option:hover {
    background: rgba(60, 60, 60, 0.8);
    border-color: var(--cyber-primary);
}

.quiz-option.selected {
    background: rgba(var(--cyber-primary-rgb), 0.2);
    border-color: var(--cyber-primary);
}

.password-analysis {
    background: rgba(30, 30, 30, 0.8);
    border-radius: 10px;
    padding: 1.5rem;
    margin: 1rem 0;
}

.analysis-item {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.analysis-item:last-child {
    border-bottom: none;
}

.analysis-good {
    color: #28a745;
}

.analysis-bad {
    color: #dc3545;
}

.analysis-neutral {
    color: #ffc107;
}
</style>
{% endblock %}

{% block content %}
<div class="container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h1 class="cyber-text glow-text mb-3">
                <i class="bi bi-shield-lock me-2"></i>–ú–∞—Å—Ç–µ—Ä –ø–∞—Ä–æ–ª–µ–π
            </h1>
            <p class="cyber-subtext lead">
                –ù–∞—É—á–∏—Ç–µ—Å—å –æ—Ü–µ–Ω–∏–≤–∞—Ç—å –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª–µ–π –∏ –∑–∞—â–∏—Ç–∏—Ç–µ —Å–≤–æ–∏ –∞–∫–∫–∞—É–Ω—Ç—ã!
            </p>
        </div>
    </div>

    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="progress-container">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="cyber-text mb-0">–¢–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è</h4>
                    <div class="cyber-subtext" id="sessionInfo">–ü–∞—Ä–æ–ª—å 1 –∏–∑ 10</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div class="stats-grid mt-3">
                    <div class="stat-card">
                        <div class="stat-value" id="currentScore">0</div>
                        <div class="stat-label">–¢–µ–∫—É—â–∏–π —Å—á–µ—Ç</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="correctAnswers">0</div>
                        <div class="stat-label">–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="averageAccuracy">0%</div>
                        <div class="stat-label">–°—Ä–µ–¥–Ω—è—è —Ç–æ—á–Ω–æ—Å—Ç—å</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="gamesPlayed">0</div>
                        <div class="stat-label">–°—ã–≥—Ä–∞–Ω–æ –∏–≥—Ä</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–∞ -->
        <div class="col-lg-8">
            <div class="password-card">
                <h3 class="cyber-text mb-4 text-center">
                    <i class="bi bi-speedometer2 me-2"></i>–û—Ü–µ–Ω–∏—Ç–µ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª—è
                </h3>
                
                <div id="gameSection">
                    <div class="password-display" id="currentPassword">
                        –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ä–æ–ª–µ–π...
                    </div>
                    
                    <div class="strength-meter">
                        <div class="strength-indicator" id="strengthIndicator" style="left: 0%;"></div>
                    </div>
                    
                    <div class="strength-labels">
                        <span>–û—á–µ–Ω—å —Å–ª–∞–±—ã–π</span>
                        <span>–°—Ä–µ–¥–Ω–∏–π</span>
                        <span>–û—á–µ–Ω—å –Ω–∞–¥–µ–∂–Ω—ã–π</span>
                    </div>
                    
                    <input type="range" class="strength-slider" id="strengthSlider" 
                           min="0" max="100" value="50" step="1">
                    
                    <div class="text-center mb-3">
                        <span class="cyber-subtext">–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞: </span>
                        <span class="cyber-text" id="userStrengthValue">50</span>
                        <span class="cyber-subtext">/100</span>
                    </div>
                    
                    <div class="text-center">
                        <button class="btn btn-cyber btn-lg" onclick="checkPassword()" id="checkButton">
                            <i class="bi bi-check-circle me-2"></i>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ü–µ–Ω–∫—É
                        </button>
                    </div>
                </div>
                
                <div id="resultSection" style="display: none;">
                    <div class="feedback-container">
                        <h5 class="cyber-text mb-3">
                            <i class="bi bi-graph-up me-2"></i>–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞
                        </h5>
                        <div id="resultContent"></div>
                    </div>
                    <div class="text-center mt-3">
                        <button class="btn btn-cyber btn-lg" onclick="nextPassword()" id="nextButton">
                            <i class="bi bi-arrow-right me-2"></i>–°–ª–µ–¥—É—é—â–∏–π –ø–∞—Ä–æ–ª—å
                        </button>
                    </div>
                </div>
            </div>

            <!-- –ê–Ω–∞–ª–∏–∑ –ø–∞—Ä–æ–ª—è -->
            <div class="password-analysis" id="analysisSection" style="display: none;">
                <h5 class="cyber-text mb-3">
                    <i class="bi bi-search me-2"></i>–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
                </h5>
                <div id="analysisContent"></div>
            </div>

            <!-- –ú–µ—Ç–æ–¥—ã –≤–∑–ª–æ–º–∞ -->
            <div class="learning-section">
                <h3 class="cyber-text mb-4">
                    <i class="bi bi-shield-exclamation me-2"></i>–ö–∞–∫ –≤–∑–ª–∞–º—ã–≤–∞—é—Ç –ø–∞—Ä–æ–ª–∏?
                </h3>
                <div id="crackingMethods">
                    <!-- –ú–µ—Ç–æ–¥—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>
        </div>

        <!-- –û–±—É—á–∞—é—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã -->
        <div class="col-lg-4">
            <!-- –°–æ–≤–µ—Ç—ã –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ -->
            <div class="learning-section">
                <h4 class="cyber-text mb-3">
                    <i class="bi bi-lightbulb me-2"></i>–ó–æ–ª–æ—Ç—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –ø–∞—Ä–æ–ª–µ–π
                </h4>
                <div id="securityTips">
                    <!-- –°–æ–≤–µ—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>

            <!-- –ú–∏–Ω–∏-–∫–≤–∏–∑ -->
            <div class="quiz-section">
                <h4 class="cyber-text mb-3">
                    <i class="bi bi-patch-question me-2"></i>–ü—Ä–æ–≤–µ—Ä—å –∑–Ω–∞–Ω–∏—è
                </h4>
                <div class="quiz-question">
                    <p class="cyber-text mb-3">–ö–∞–∫–æ–π –ø–∞—Ä–æ–ª—å —Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π?</p>
                    <div class="quiz-option" onclick="selectQuizOption(0)">A. 123456</div>
                    <div class="quiz-option" onclick="selectQuizOption(1)">B. Password2024!</div>
                    <div class="quiz-option" onclick="selectQuizOption(2)">C. Xk8&zQ2#pL9$mN5*</div>
                    <div class="quiz-option" onclick="selectQuizOption(3)">D. IloveMyCat123</div>
                </div>
                <button class="btn btn-cyber w-100" onclick="checkQuizAnswer()" id="quizButton">
                    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç
                </button>
                <div id="quizResult" class="mt-3" style="display: none;"></div>
            </div>

            <!-- –®–∫–∞–ª–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤–∑–ª–æ–º–∞ -->
            <div class="learning-section">
                <h4 class="cyber-text mb-3">
                    <i class="bi bi-clock me-2"></i>–í—Ä–µ–º—è –≤–∑–ª–æ–º–∞ –ø–∞—Ä–æ–ª–µ–π
                </h4>
                <div class="tip-card">
                    <h6 class="cyber-text">üîì –ü—Ä–æ—Å—Ç—ã–µ –ø–∞—Ä–æ–ª–∏ (6 —Å–∏–º–≤–æ–ª–æ–≤)</h6>
                    <p class="cyber-subtext small mb-2">–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ - –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥</p>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar bg-danger" style="width: 100%"></div>
                    </div>
                </div>
                <div class="tip-card">
                    <h6 class="cyber-text">üîê –°—Ä–µ–¥–Ω–∏–µ –ø–∞—Ä–æ–ª–∏ (8-10 —Å–∏–º–≤–æ–ª–æ–≤)</h6>
                    <p class="cyber-subtext small mb-2">–ú–∏–Ω—É—Ç—ã - –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π</p>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar bg-warning" style="width: 70%"></div>
                    </div>
                </div>
                <div class="tip-card">
                    <h6 class="cyber-text">üîí –°–ª–æ–∂–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ (12+ —Å–∏–º–≤–æ–ª–æ–≤)</h6>
                    <p class="cyber-subtext small mb-2">–ì–æ–¥—ã - —Å—Ç–æ–ª–µ—Ç–∏—è</p>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar bg-success" style="width: 30%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let currentPasswords = [];
let currentPasswordIndex = 0;
let gameStats = {
    played: 0,
    totalScore: 0,
    roundsPlayed: 0,
    correctAnswers: 0,
    totalRounds: 0
};
let securityTips = [];
let crackingMethods = [];

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
async function loadGameData() {
    try {
        await Promise.all([
            loadPasswords(),
            loadSecurityTips(),
            loadCrackingMethods()
        ]);
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
        showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã');
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ä–æ–ª–µ–π –¥–ª—è –∏–≥—Ä—ã
async function loadPasswords() {
    const response = await fetch('/games/api/games/password/strength');
    const data = await response.json();
    currentPasswords = data.passwords;
    currentPasswordIndex = 0;
    gameStats.totalRounds = currentPasswords.length;
    displayCurrentPassword();
    updateStats();
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–≤–µ—Ç–æ–≤ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
async function loadSecurityTips() {
    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —ç—Ç–æ –±—ã –ø—Ä–∏—Ö–æ–¥–∏–ª–æ —Å —Å–µ—Ä–≤–µ—Ä–∞
    securityTips = [
        {
            'title': '–î–ª–∏–Ω–∞ –≤–∞–∂–Ω–µ–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏',
            'content': '–ü–∞—Ä–æ–ª—å –∏–∑ 12+ —Å–ª—É—á–∞–π–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞–¥–µ–∂–Ω–µ–µ –∫–æ—Ä–æ—Ç–∫–æ–≥–æ —Å–ª–æ–∂–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è.',
            'icon': 'bi-arrows-expand',
            'importance': 'high'
        },
        {
            'title': '–ù–µ –ø–æ–≤—Ç–æ—Ä—è–π—Ç–µ –ø–∞—Ä–æ–ª–∏',
            'content': '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.',
            'icon': 'bi-shield-check',
            'importance': 'critical'
        },
        {
            'title': '–ò–∑–±–µ–≥–∞–π—Ç–µ –ª–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏',
            'content': '–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–º–µ–Ω–∞, –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è –∏–ª–∏ –¥—Ä—É–≥—É—é –ª–∏—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.',
            'icon': 'bi-person-x',
            'importance': 'high'
        }
    ];
    displaySecurityTips();
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ—Ç–æ–¥–æ–≤ –≤–∑–ª–æ–º–∞
async function loadCrackingMethods() {
    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —ç—Ç–æ –±—ã –ø—Ä–∏—Ö–æ–¥–∏–ª–æ —Å —Å–µ—Ä–≤–µ—Ä–∞
    crackingMethods = [
        {
            'name': '–ü–µ—Ä–µ–±–æ—Ä –ø–æ —Å–ª–æ–≤–∞—Ä—é',
            'description': '–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ç–∏–≤ —Å–ø–∏—Å–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π –∏ —Å–ª–æ–≤ –∏–∑ —Å–ª–æ–≤–∞—Ä—è.',
            'speed': '–û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ',
            'protection': '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª—É—á–∞–π–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏'
        },
        {
            'name': '–ë—Ä—É—Ç—Ñ–æ—Ä—Å-–∞—Ç–∞–∫–∞',
            'description': '–ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–±–æ—Ä –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π —Å–∏–º–≤–æ–ª–æ–≤.',
            'speed': '–ú–µ–¥–ª–µ–Ω–Ω–æ –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π',
            'protection': '–ü–∞—Ä–æ–ª–∏ 12+ —Å–∏–º–≤–æ–ª–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏'
        }
    ];
    displayCrackingMethods();
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–∞—Ä–æ–ª—è
function displayCurrentPassword() {
    if (currentPasswordIndex >= currentPasswords.length) {
        endGame();
        return;
    }
    
    const password = currentPasswords[currentPasswordIndex];
    document.getElementById('currentPassword').textContent = password.password;
    document.getElementById('strengthSlider').value = 50;
    updateStrengthIndicator(50);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤—É—é —Å–µ–∫—Ü–∏—é, —Å–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –∞–Ω–∞–ª–∏–∑
    document.getElementById('gameSection').style.display = 'block';
    document.getElementById('resultSection').style.display = 'none';
    document.getElementById('analysisSection').style.display = 'none';
    
    updateProgress();
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ —Å–∏–ª—ã
function updateStrengthIndicator(value) {
    const indicator = document.getElementById('strengthIndicator');
    indicator.style.left = value + '%';
    document.getElementById('userStrengthValue').textContent = value;
}

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å
async function checkPassword() {
    const password = currentPasswords[currentPasswordIndex];
    const userStrength = parseInt(document.getElementById('strengthSlider').value);
    
    try {
        const response = await fetch('/games/api/games/password/check', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                password: password.password,
                strength: userStrength
            })
        });
        
        const result = await response.json();
        showResult(result, password);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        gameStats.played++;
        gameStats.roundsPlayed++;
        gameStats.totalScore += result.score;
        if (result.score >= 80) gameStats.correctAnswers++;
        updateStats();
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:', error);
        showError('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–æ–ª—è');
    }
}

// –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
function showResult(result, password) {
    const resultContent = document.getElementById('resultContent');
    const analysisContent = document.getElementById('analysisContent');
    
    // –û—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    resultContent.innerHTML = `
        <div class="mb-3">
            <div class="analysis-item">
                <span>–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞:</span>
                <span class="cyber-text">${result.user_strength}/100</span>
            </div>
            <div class="analysis-item">
                <span>–†–µ–∞–ª—å–Ω–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å:</span>
                <span class="cyber-text">${result.actual_strength}/100</span>
            </div>
            <div class="analysis-item">
                <span>–¢–æ—á–Ω–æ—Å—Ç—å –æ—Ü–µ–Ω–∫–∏:</span>
                <span class="${result.score >= 80 ? 'analysis-good' : result.score >= 60 ? 'analysis-neutral' : 'analysis-bad'}">
                    ${result.accuracy}
                </span>
            </div>
            <div class="analysis-item">
                <span>–í—Ä–µ–º—è –≤–∑–ª–æ–º–∞:</span>
                <span class="cyber-text">${result.time_to_crack}</span>
            </div>
        </div>
        <div class="alert ${result.score >= 80 ? 'alert-success' : result.score >= 60 ? 'alert-warning' : 'alert-danger'}">
            <strong>${result.feedback}</strong><br>
            <small>–ü–æ–ª—É—á–µ–Ω–æ –æ—á–∫–æ–≤: <strong>${result.score}</strong></small>
        </div>
    `;
    
    // –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
    analysisContent.innerHTML = `
        <div class="analysis-item">
            <span>–î–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è:</span>
            <span class="${password.password.length >= 12 ? 'analysis-good' : 'analysis-bad'}">
                ${password.password.length} —Å–∏–º–≤–æ–ª–æ–≤
            </span>
        </div>
        <div class="analysis-item">
            <span>–†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ —Å–∏–º–≤–æ–ª–æ–≤:</span>
            <span class="${hasCharacterVariety(password.password) ? 'analysis-good' : 'analysis-bad'}">
                ${getCharacterVarietyText(password.password)}
            </span>
        </div>
        <div class="analysis-item">
            <span>–°–ª—É—á–∞–π–Ω–æ—Å—Ç—å:</span>
            <span class="${isRandom(password.password) ? 'analysis-good' : 'analysis-bad'}">
                ${isRandom(password.password) ? '–í—ã—Å–æ–∫–∞—è' : '–ù–∏–∑–∫–∞—è'}
            </span>
        </div>
    `;
    
    document.getElementById('gameSection').style.display = 'none';
    document.getElementById('resultSection').style.display = 'block';
    document.getElementById('analysisSection').style.display = 'block';
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
function hasCharacterVariety(password) {
    const hasUpper = /[A-Z]/.test(password);
    const hasLower = /[a-z]/.test(password);
    const hasNumber = /[0-9]/.test(password);
    const hasSpecial = /[^A-Za-z0-9]/.test(password);
    
    let varietyCount = 0;
    if (hasUpper) varietyCount++;
    if (hasLower) varietyCount++;
    if (hasNumber) varietyCount++;
    if (hasSpecial) varietyCount++;
    
    return varietyCount >= 3;
}

function getCharacterVarietyText(password) {
    const types = [];
    if (/[A-Z]/.test(password)) types.push('A-Z');
    if (/[a-z]/.test(password)) types.push('a-z');
    if (/[0-9]/.test(password)) types.push('0-9');
    if (/[^A-Za-z0-9]/.test(password)) types.push('—Å–ø–µ—Ü.');
    
    return types.join(', ');
}

function isRandom(password) {
    // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å
    const commonPatterns = [
        '123', 'abc', 'qwe', 'password', 'admin', '2024', '2023'
    ];
    
    return !commonPatterns.some(pattern => 
        password.toLowerCase().includes(pattern)
    );
}

// –°–ª–µ–¥—É—é—â–∏–π –ø–∞—Ä–æ–ª—å
function nextPassword() {
    currentPasswordIndex++;
    displayCurrentPassword();
}

// –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É
function endGame() {
    document.getElementById('gameSection').innerHTML = `
        <div class="text-center">
            <i class="bi bi-trophy display-1 text-warning mb-3"></i>
            <h4 class="cyber-text mb-3">–°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h4>
            <p class="cyber-subtext">–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –ø–∞—Ä–æ–ª–µ–π: ${gameStats.roundsPlayed}</p>
            <p class="cyber-subtext">–û–±—â–∏–π —Å—á–µ—Ç: ${gameStats.totalScore}</p>
            <p class="cyber-subtext">–¢–æ—á–Ω–æ—Å—Ç—å: ${Math.round((gameStats.correctAnswers / gameStats.roundsPlayed) * 100)}%</p>
            <button class="btn btn-cyber mt-2" onclick="loadPasswords()">
                <i class="bi bi-arrow-repeat me-2"></i>–ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é
            </button>
        </div>
    `;
    document.getElementById('resultSection').style.display = 'none';
    document.getElementById('analysisSection').style.display = 'none';
}

// –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
function updateStats() {
    document.getElementById('gamesPlayed').textContent = gameStats.played;
    document.getElementById('currentScore').textContent = gameStats.totalScore;
    document.getElementById('correctAnswers').textContent = gameStats.correctAnswers;
    document.getElementById('averageAccuracy').textContent = gameStats.roundsPlayed > 0 ? 
        Math.round((gameStats.correctAnswers / gameStats.roundsPlayed) * 100) + '%' : '0%';
}

// –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
function updateProgress() {
    const progress = (currentPasswordIndex / currentPasswords.length) * 100;
    document.getElementById('progressFill').style.width = progress + '%';
    document.getElementById('sessionInfo').textContent = 
        `–ü–∞—Ä–æ–ª—å ${currentPasswordIndex + 1} –∏–∑ ${currentPasswords.length}`;
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–≤–µ—Ç–æ–≤ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
function displaySecurityTips() {
    const tipsContainer = document.getElementById('securityTips');
    tipsContainer.innerHTML = securityTips.map(tip => `
        <div class="tip-card ${tip.importance}">
            <div class="d-flex align-items-start">
                <i class="${tip.icon} tip-icon"></i>
                <div>
                    <h6 class="cyber-text mb-2">${tip.title}</h6>
                    <p class="cyber-subtext small mb-0">${tip.content}</p>
                </div>
            </div>
        </div>
    `).join('');
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –≤–∑–ª–æ–º–∞
function displayCrackingMethods() {
    const methodsContainer = document.getElementById('crackingMethods');
    methodsContainer.innerHTML = crackingMethods.map(method => `
        <div class="cracking-method">
            <div class="method-header">
                <h6 class="cyber-text mb-0">${method.name}</h6>
                <span class="method-speed">${method.speed}</span>
            </div>
            <p class="cyber-subtext small mb-2">${method.description}</p>
            <div class="cyber-subtext smaller">
                <strong>–ó–∞—â–∏—Ç–∞:</strong> ${method.protection}
            </div>
        </div>
    `).join('');
}

// –ú–∏–Ω–∏-–∫–≤–∏–∑
let selectedQuizOption = null;

function selectQuizOption(index) {
    document.querySelectorAll('.quiz-option').forEach((option, i) => {
        option.classList.toggle('selected', i === index);
    });
    selectedQuizOption = index;
}

function checkQuizAnswer() {
    const correctAnswer = 2; // –ò–Ω–¥–µ–∫—Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (C)
    const resultDiv = document.getElementById('quizResult');
    
    if (selectedQuizOption === null) {
        resultDiv.innerHTML = '<div class="alert alert-warning">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞!</div>';
        resultDiv.style.display = 'block';
        return;
    }
    
    if (selectedQuizOption === correctAnswer) {
        resultDiv.innerHTML = `
            <div class="alert alert-success">
                <i class="bi bi-check-circle me-2"></i>
                –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –î–ª–∏–Ω–Ω—ã–µ —Å–ª—É—á–∞–π–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏ –Ω–∞–∏–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã.
            </div>
        `;
    } else {
        resultDiv.innerHTML = `
            <div class="alert alert-danger">
                <i class="bi bi-x-circle me-2"></i>
                –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ! –°–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å - –¥–ª–∏–Ω–Ω—ã–π –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–ª—É—á–∞–π–Ω—ã–π.
            </div>
        `;
    }
    resultDiv.style.display = 'block';
}

// –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
function showError(message) {
    document.getElementById('gameSection').innerHTML = `
        <div class="text-center text-danger">
            <i class="bi bi-exclamation-triangle display-4"></i>
            <p class="mt-3">${message}</p>
            <button class="btn btn-cyber mt-2" onclick="loadGameData()">
                <i class="bi bi-arrow-repeat me-2"></i>–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
            </button>
        </div>
    `;
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ —Å–ª–∞–π–¥–µ—Ä–∞
document.getElementById('strengthSlider').addEventListener('input', function() {
    updateStrengthIndicator(this.value);
});

// –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    loadGameData();
    updateStrengthIndicator(50);
});
</script>
{% endblock %}
