{% extends "base.html" %}

{% block title %}–°–∫–∞–Ω–µ—Ä Email - CyberGuardian{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="text-center mb-5">
                <h1 class="cyber-text glow-text mb-3">
                    <i class="bi bi-envelope me-2"></i>–°–∫–∞–Ω–µ—Ä Email –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                </h1>
                <p class="cyber-subtext lead">
                    –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–∞—à–µ–≥–æ email –∞–∫–∫–∞—É–Ω—Ç–∞
                </p>
            </div>

            <div class="scanner-card">
                <h4 class="cyber-text mb-4">üìß –ü—Ä–æ–≤–µ—Ä–∫–∞ Email</h4>
                
                <div class="mb-4">
                    <label class="form-label cyber-text">–í–≤–µ–¥–∏—Ç–µ email –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:</label>
                    <input type="email" class="form-control cyber-input" id="emailInput" 
                           placeholder="example@mail.ru">
                    <small class="cyber-subtext">
                        –ú—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ–º –≤–∞—à email —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º
                    </small>
                </div>

                <button onclick="scanEmail()" class="btn btn-cyber w-100 mb-4">
                    <i class="bi bi-search me-2"></i>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Email
                </button>

                <div class="scan-result" id="emailResult" style="display: none;">
                    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–≥—Ä—É–∑—è—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>

            <!-- –°–æ–≤–µ—Ç—ã –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ email -->
            <div class="scanner-card mt-4">
                <h4 class="cyber-text mb-4">üí° –°–æ–≤–µ—Ç—ã –ø–æ –∑–∞—â–∏—Ç–µ Email</h4>
                <div class="row">
                    <div class="col-md-6">
                        <div class="content-tip mb-3">
                            <i class="bi bi-shield-check me-2"></i>
                            <strong>–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</strong>
                            <p class="mb-0">–í–∫–ª—é—á–∏—Ç–µ 2FA –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã</p>
                        </div>
                        <div class="content-tip mb-3">
                            <i class="bi bi-key me-2"></i>
                            <strong>–ù–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å</strong>
                            <p class="mb-0">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–æ–∂–Ω—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="content-tip mb-3">
                            <i class="bi bi-eye-slash me-2"></i>
                            <strong>–û—Å—Ç–µ—Ä–µ–≥–∞–π—Ç–µ—Å—å —Ñ–∏—à–∏–Ω–≥–∞</strong>
                            <p class="mb-0">–ù–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –ø–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–º —Å—Å—ã–ª–∫–∞–º</p>
                        </div>
                        <div class="content-tip">
                            <i class="bi bi-bell me-2"></i>
                            <strong>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</strong>
                            <p class="mb-0">–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –≤—Ö–æ–¥–æ–≤</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// –ü—Ä–æ–≤–µ—Ä–∫–∞ email
async function scanEmail() {
    const email = document.getElementById('emailInput').value;
    
    if (!email || !email.includes('@')) {
        alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∞–¥—Ä–µ—Å');
        return;
    }
    
    try {
        const response = await fetch('/scanner/api/scan/email', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email: email })
        });
        
        const result = await response.json();
        displayEmailResult(result);
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ email:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ email');
    }
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
function displayEmailResult(result) {
    const container = document.getElementById('emailResult');
    
    container.style.display = 'block';
    container.innerHTML = `
        <h5 class="cyber-text mb-3">
            <i class="bi bi-${result.score >= 80 ? 'check-circle text-success' : 
                              result.score >= 60 ? 'exclamation-triangle text-warning' : 
                              'exclamation-circle text-danger'} me-2"></i>
            –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
        </h5>
        
        <div class="row text-center mb-4">
            <div class="col-md-6">
                <div class="security-level level-${getSecurityLevel(result.score)}">
                    ${result.score}%
                </div>
                <p class="cyber-subtext">–û—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</p>
            </div>
            <div class="col-md-6">
                <div class="security-level">
                    ${result.issues.length}
                </div>
                <p class="cyber-subtext">–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –ø—Ä–æ–±–ª–µ–º</p>
            </div>
        </div>
        
        <div class="security-meter mb-3">
            <div class="meter-fill" style="width: ${result.score}%; background: ${getSecurityColor(result.score)};"></div>
        </div>
        
        ${result.issues.length > 0 ? `
            <h6 class="cyber-text mb-3 text-danger">‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:</h6>
            <div class="row">
                ${result.issues.map(issue => `
                    <div class="col-12 mb-2">
                        <i class="bi bi-exclamation-circle text-danger me-2"></i>
                        <span class="cyber-subtext">${issue}</span>
                    </div>
                `).join('')}
            </div>
        ` : ''}
        
        ${result.recommendations.length > 0 ? `
            <h6 class="cyber-text mb-3 text-success">üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h6>
            <div class="row">
                ${result.recommendations.map(rec => `
                    <div class="col-12 mb-2">
                        <i class="bi bi-check-circle text-success me-2"></i>
                        <span class="cyber-subtext">${rec}</span>
                    </div>
                `).join('')}
            </div>
        ` : ''}
    `;
}

// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
function getSecurityLevel(score) {
    if (score >= 80) return 'excellent';
    if (score >= 70) return 'good';
    if (score >= 50) return 'fair';
    if (score >= 30) return 'poor';
    return 'critical';
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –¥–ª—è —É—Ä–æ–≤–Ω—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
function getSecurityColor(score) {
    if (score >= 80) return '#20c997';
    if (score >= 70) return '#0dcaf0';
    if (score >= 50) return '#ffc107';
    if (score >= 30) return '#fd7e14';
    return '#dc3545';
}
</script>
{% endblock %}
