{% extends "base.html" %}

{% block title %}–°–∫–∞–Ω–µ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ - CyberGuardian{% endblock %}

{% block extra_css %}
<style>
.scanner-card {
    border: 2px solid var(--cyber-border);
    border-radius: 15px;
    padding: 2rem;
    margin-bottom: 2rem;
    transition: all 0.3s ease;
    background: rgba(20, 20, 20, 0.8);
}

.scanner-card:hover {
    border-color: var(--cyber-primary);
    transform: translateY(-5px);
}

.scan-result {
    background: rgba(30, 30, 30, 0.8);
    border-radius: 10px;
    padding: 1.5rem;
    margin-top: 1.5rem;
    border-left: 4px solid var(--cyber-primary);
}

.security-meter {
    height: 20px;
    background: rgba(30, 30, 30, 0.8);
    border-radius: 10px;
    overflow: hidden;
    margin: 1rem 0;
    position: relative;
}

.meter-fill {
    height: 100%;
    border-radius: 10px;
    transition: width 1s ease-in-out;
    position: relative;
    overflow: hidden;
}

.meter-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    animation: meterShine 2s infinite;
}

@keyframes meterShine {
    0% { left: -100%; }
    100% { left: 100%; }
}

.scan-animation {
    display: none;
    text-align: center;
    padding: 2rem;
}

.scan-progress {
    width: 100%;
    height: 4px;
    background: rgba(30, 30, 30, 0.8);
    border-radius: 2px;
    overflow: hidden;
    margin: 1rem 0;
}

.progress-bar {
    height: 100%;
    background: var(--cyber-primary);
    border-radius: 2px;
    transition: width 0.3s ease;
}

.port-status {
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: bold;
}

.status-open { background: rgba(220, 53, 69, 0.2); color: #dc3545; border: 1px solid #dc3545; }
.status-closed { background: rgba(32, 201, 151, 0.2); color: #20c997; border: 1px solid #20c997; }
.status-filtered { background: rgba(255, 193, 7, 0.2); color: #ffc107; border: 1px solid #ffc107; }

.security-level {
    font-size: 2rem;
    font-weight: bold;
    text-align: center;
    margin: 1rem 0;
}

.level-excellent { color: #20c997; }
.level-good { color: #0dcaf0; }
.level-fair { color: #ffc107; }
.level-poor { color: #fd7e14; }
.level-critical { color: #dc3545; }

.quick-scan-btn {
    background: linear-gradient(135deg, var(--cyber-primary), var(--cyber-secondary));
    border: none;
    color: black;
    padding: 1rem 2rem;
    border-radius: 10px;
    font-weight: bold;
    transition: all 0.3s ease;
}

.quick-scan-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 5px 20px rgba(0, 255, 136, 0.3);
}

.scanner-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin: 2rem 0;
}
</style>
{% endblock %}

{% block content %}
<div class="container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="row mb-5">
        <div class="col-12 text-center">
            <h1 class="cyber-text glow-text mb-3">
                <i class="bi bi-shield-check me-2"></i>–°–∫–∞–Ω–µ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
            </h1>
            <p class="cyber-subtext lead">
                –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞—à–µ–π —Ü–∏—Ñ—Ä–æ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
            </p>
        </div>
    </div>

    <!-- –ë—ã—Å—Ç—Ä–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="scanner-card text-center">
                <i class="bi bi-speedometer2 display-1 text-cyber-primary mb-3"></i>
                <h3 class="cyber-text mb-3">–ë—ã—Å—Ç—Ä–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã</h3>
                <p class="cyber-subtext mb-4">
                    –ü—Ä–æ–≤–µ–¥–∏—Ç–µ –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∑–∞ 30 —Å–µ–∫—É–Ω–¥
                </p>
                <button class="quick-scan-btn" onclick="runQuickScan()">
                    <i class="bi bi-play-circle me-2"></i>–ó–∞–ø—É—Å—Ç–∏—Ç—å –±—ã—Å—Ç—Ä–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                </button>
                
                <div class="scan-animation" id="quickScanAnimation">
                    <div class="cyber-loader mx-auto mb-3"></div>
                    <p class="cyber-text">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã...</p>
                    <div class="scan-progress">
                        <div class="progress-bar" id="scanProgress" style="width: 0%"></div>
                    </div>
                </div>
                
                <div class="scan-result" id="quickScanResult" style="display: none;">
                    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–≥—Ä—É–∑—è—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div class="row">
        <div class="col-12">
            <h3 class="cyber-text mb-4">üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
            <div class="scanner-grid">
                <!-- –°–∫–∞–Ω–µ—Ä –ø–∞—Ä–æ–ª–µ–π -->
                <div class="scanner-card">
                    <div class="d-flex align-items-start mb-3">
                        <i class="bi bi-key display-4 text-cyber-primary me-3"></i>
                        <div>
                            <h4 class="cyber-text">–°–∫–∞–Ω–µ—Ä –ø–∞—Ä–æ–ª–µ–π</h4>
                            <p class="cyber-subtext">–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –≤–∞—à–∏—Ö –ø–∞—Ä–æ–ª–µ–π</p>
                        </div>
                    </div>
                    <a href="{{ url_for('scanner.password_scanner') }}" class="btn btn-cyber w-100">
                        <i class="bi bi-shield-lock me-2"></i>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª–∏
                    </a>
                </div>

                <!-- –°–∫–∞–Ω–µ—Ä email -->
                <div class="scanner-card">
                    <div class="d-flex align-items-start mb-3">
                        <i class="bi bi-envelope display-4 text-cyber-secondary me-3"></i>
                        <div>
                            <h4 class="cyber-text">–°–∫–∞–Ω–µ—Ä Email</h4>
                            <p class="cyber-subtext">–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ email –∞–∫–∫–∞—É–Ω—Ç–∞</p>
                        </div>
                    </div>
                    <a href="{{ url_for('scanner.email_scanner') }}" class="btn btn-cyber w-100">
                        <i class="bi bi-search me-2"></i>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Email
                    </a>
                </div>

                <!-- –°–∫–∞–Ω–µ—Ä —Å–µ—Ç–∏ -->
                <div class="scanner-card">
                    <div class="d-flex align-items-start mb-3">
                        <i class="bi bi-hdd-network display-4 text-cyber-accent me-3"></i>
                        <div>
                            <h4 class="cyber-text">–°–∫–∞–Ω–µ—Ä —Å–µ—Ç–∏</h4>
                            <p class="cyber-subtext">–ê–Ω–∞–ª–∏–∑ —Å–µ—Ç–µ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</p>
                        </div>
                    </div>
                    <a href="{{ url_for('scanner.network_scanner') }}" class="btn btn-cyber w-100">
                        <i class="bi bi-wifi me-2"></i>–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç—å
                    </a>
                </div>

                <!-- –°–∫–∞–Ω–µ—Ä —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π -->
                <div class="scanner-card">
                    <div class="d-flex align-items-start mb-3">
                        <i class="bi bi-bug display-4 text-danger me-3"></i>
                        <div>
                            <h4 class="cyber-text">–°–∫–∞–Ω–µ—Ä —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π</h4>
                            <p class="cyber-subtext">–ü–æ–∏—Å–∫ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ</p>
                        </div>
                    </div>
                    <a href="{{ url_for('scanner.vulnerability_scanner') }}" class="btn btn-cyber w-100">
                        <i class="bi bi-shield-exclamation me-2"></i>–ù–∞–π—Ç–∏ —É—è–∑–≤–∏–º–æ—Å—Ç–∏
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="scanner-card">
                <h3 class="cyber-text mb-4">üìä –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3>
                <div class="row">
                    <div class="col-md-6">
                        <div class="content-tip mb-3">
                            <i class="bi bi-check-circle me-2"></i>
                            <strong>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞—Ä–æ–ª–µ–π</strong>
                            <p class="mb-0">–•—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ</p>
                        </div>
                        <div class="content-tip mb-3">
                            <i class="bi bi-check-circle me-2"></i>
                            <strong>–í–∫–ª—é—á–∏—Ç–µ 2FA</strong>
                            <p class="mb-0">–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è –≤–∞–∂–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="content-tip mb-3">
                            <i class="bi bi-check-circle me-2"></i>
                            <strong>–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –ü–û</strong>
                            <p class="mb-0">–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</p>
                        </div>
                        <div class="content-tip">
                            <i class="bi bi-check-circle me-2"></i>
                            <strong>–î–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏</strong>
                            <p class="mb-0">–†–µ–≥—É–ª—è—Ä–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// –ë—ã—Å—Ç—Ä–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
async function runQuickScan() {
    const animation = document.getElementById('quickScanAnimation');
    const result = document.getElementById('quickScanResult');
    const progress = document.getElementById('scanProgress');
    const button = document.querySelector('.quick-scan-btn');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
    button.style.display = 'none';
    animation.style.display = 'block';
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    let width = 0;
    const interval = setInterval(() => {
        width += 5;
        progress.style.width = width + '%';
        if (width >= 100) clearInterval(interval);
    }, 150);
    
    try {
        // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
        const response = await fetch('/scanner/api/scan/quick');
        const data = await response.json();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        animation.style.display = 'none';
        result.style.display = 'block';
        
        result.innerHTML = `
            <h4 class="cyber-text mb-3">
                <i class="bi bi-check-circle text-success me-2"></i>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
            </h4>
            
            <div class="row text-center mb-4">
                <div class="col-md-3">
                    <div class="security-level level-${getSecurityLevel(data.system_security)}">
                        ${data.system_security}%
                    </div>
                    <p class="cyber-subtext">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã</p>
                </div>
                <div class="col-md-3">
                    <div class="security-level level-${getSecurityLevel(data.network_security)}">
                        ${data.network_security}%
                    </div>
                    <p class="cyber-subtext">–°–µ—Ç–µ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</p>
                </div>
                <div class="col-md-3">
                    <div class="security-level level-${getSecurityLevel(data.password_security)}">
                        ${data.password_security}%
                    </div>
                    <p class="cyber-subtext">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª–µ–π</p>
                </div>
                <div class="col-md-3">
                    <div class="security-level level-${data.threats_found > 0 ? 'critical' : 'excellent'}">
                        ${data.threats_found}
                    </div>
                    <p class="cyber-subtext">–ù–∞–π–¥–µ–Ω–æ —É–≥—Ä–æ–∑</p>
                </div>
            </div>
            
            <div class="security-meter mb-3">
                <div class="meter-fill" style="width: ${data.system_security}%; background: ${getSecurityColor(data.system_security)};"></div>
            </div>
            
            <h5 class="cyber-text mb-3">üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h5>
            <div class="row">
                ${data.recommendations.map(rec => `
                    <div class="col-md-6 mb-2">
                        <i class="bi bi-arrow-right text-cyber-primary me-2"></i>
                        <span class="cyber-subtext">${rec}</span>
                    </div>
                `).join('')}
            </div>
            
            <div class="text-center mt-4">
                <button class="btn btn-cyber-outline" onclick="runQuickScan()">
                    <i class="bi bi-arrow-repeat me-2"></i>–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                </button>
            </div>
        `;
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
        animation.style.display = 'none';
        result.style.display = 'block';
        result.innerHTML = `
            <div class="alert alert-danger">
                <i class="bi bi-exclamation-triangle me-2"></i>
                –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.
            </div>
        `;
    }
}

// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
function getSecurityLevel(score) {
    if (score >= 90) return 'excellent';
    if (score >= 70) return 'good';
    if (score >= 50) return 'fair';
    if (score >= 30) return 'poor';
    return 'critical';
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –¥–ª—è —É—Ä–æ–≤–Ω—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
function getSecurityColor(score) {
    if (score >= 90) return '#20c997';
    if (score >= 70) return '#0dcaf0';
    if (score >= 50) return '#ffc107';
    if (score >= 30) return '#fd7e14';
    return '#dc3545';
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
    // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    // runQuickScan();
});
</script>
{% endblock %}