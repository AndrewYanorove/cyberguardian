<!-- [file name]: templates/forum/forum_home.html -->
{% extends "base.html" %}
{% block title %}–§–æ—Ä—É–º –∏—Å—Ç–æ—Ä–∏–π - CyberGuardian{% endblock %}

{% block extra_css %}
<style>
.forum-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
    animation: fadeIn 0.8s ease;
}

.forum-header {
    text-align: center;
    margin-bottom: 3rem;
    padding: 3rem 0;
    border-bottom: 2px solid var(--cyber-border);
    position: relative;
    overflow: hidden;
}

.forum-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, var(--cyber-primary), var(--cyber-accent));
}

.forum-title {
    font-size: 3rem;
    font-weight: 800;
    margin-bottom: 1rem;
    background: linear-gradient(135deg, var(--cyber-text-bright), var(--cyber-primary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    position: relative;
}

.forum-subtitle {
    font-size: 1.3rem;
    color: var(--cyber-subtext);
    margin-bottom: 2rem;
    font-weight: 300;
}

.stories-list {
    display: grid;
    gap: 2rem;
    margin-bottom: 3rem;
}

.story-item {
    background: var(--cyber-bg-card);
    border: 2px solid var(--cyber-border);
    border-radius: 25px;
    padding: 2rem;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    animation: slideInUp 0.6s ease;
}

.story-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(0, 168, 255, 0.05), rgba(148, 0, 211, 0.05));
    opacity: 0;
    transition: opacity 0.3s ease;
}

.story-item:hover {
    border-color: var(--cyber-primary);
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 20px 60px rgba(0, 168, 255, 0.15);
}

.story-item:hover::before {
    opacity: 1;
}

.story-meta {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.2rem;
    font-size: 0.9rem;
    color: var(--cyber-subtext);
    flex-wrap: wrap;
}

.story-category {
    background: linear-gradient(135deg, var(--cyber-primary), var(--cyber-accent));
    color: #000;
    padding: 0.5rem 1.2rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 15px rgba(0, 168, 255, 0.3);
}

.story-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 1rem;
    color: var(--cyber-text-bright);
    line-height: 1.4;
}

.story-title a {
    color: inherit;
    text-decoration: none;
    transition: all 0.3s ease;
    display: block;
}

.story-title a:hover {
    color: var(--cyber-primary);
    transform: translateX(5px);
}

.story-preview {
    color: var(--cyber-text);
    line-height: 1.7;
    margin-bottom: 1.5rem;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    font-size: 1.05rem;
}

.story-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 1.5rem;
    border-top: 2px solid var(--cyber-border);
    position: relative;
}

.story-author {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    color: var(--cyber-subtext);
    font-size: 0.95rem;
    font-weight: 600;
}

.author-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--cyber-primary), var(--cyber-accent));
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 0.9rem;
    box-shadow: 0 4px 15px rgba(0, 168, 255, 0.3);
}

.story-stats {
    display: flex;
    gap: 1.5rem;
    color: var(--cyber-subtext);
    font-size: 0.9rem;
}

.stat {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: var(--cyber-darker);
    border-radius: 15px;
    transition: all 0.3s ease;
}

.stat:hover {
    background: var(--cyber-border);
    transform: translateY(-2px);
}

.create-story-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.8rem;
    margin: 2rem auto 3rem;
    text-align: center;
    background: linear-gradient(135deg, var(--cyber-primary), var(--cyber-accent));
    color: #000;
    padding: 1.2rem 2.5rem;
    border-radius: 20px;
    text-decoration: none;
    font-weight: 700;
    font-size: 1.1rem;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 8px 30px rgba(0, 168, 255, 0.3);
    border: 2px solid transparent;
    position: relative;
    overflow: hidden;
}

.create-story-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s ease;
}

.create-story-btn:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 0 15px 40px rgba(0, 168, 255, 0.4);
    text-decoration: none;
    color: #000;
}

.create-story-btn:hover::before {
    left: 100%;
}

.empty-state {
    text-align: center;
    padding: 5rem 2rem;
    color: var(--cyber-subtext);
    animation: fadeIn 1s ease;
}

.empty-state i {
    font-size: 5rem;
    margin-bottom: 1.5rem;
    opacity: 0.3;
}

.empty-state h3 {
    font-size: 1.8rem;
    margin-bottom: 1rem;
    color: var(--cyber-text-bright);
}

.empty-state p {
    font-size: 1.1rem;
    margin-bottom: 2rem;
}

.pagination {
    display: flex;
    justify-content: center;
    gap: 0.8rem;
    margin: 4rem 0;
}

.page-link {
    padding: 0.8rem 1.2rem;
    border: 2px solid var(--cyber-border);
    border-radius: 15px;
    color: var(--cyber-text);
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    min-width: 50px;
    text-align: center;
}

.page-link:hover {
    border-color: var(--cyber-primary);
    color: var(--cyber-primary);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 168, 255, 0.2);
}

.page-link.active {
    background: linear-gradient(135deg, var(--cyber-primary), var(--cyber-accent));
    border-color: transparent;
    color: #000;
    box-shadow: 0 5px 15px rgba(0, 168, 255, 0.3);
}

.forum-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1.5rem;
    margin: 3rem 0;
}

.stat-card {
    background: var(--cyber-bg-card);
    border: 2px solid var(--cyber-border);
    border-radius: 20px;
    padding: 2rem 1.5rem;
    text-align: center;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, var(--cyber-primary), var(--cyber-accent));
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
    border-color: var(--cyber-primary);
}

.stat-number {
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--cyber-primary);
    display: block;
    line-height: 1;
    margin-bottom: 0.5rem;
}

.stat-label {
    color: var(--cyber-subtext);
    font-size: 0.9rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.filters {
    display: flex;
    gap: 1rem;
    margin-bottom: 2.5rem;
    flex-wrap: wrap;
    justify-content: center;
}

.filter-btn {
    padding: 0.8rem 1.5rem;
    border: 2px solid var(--cyber-border);
    border-radius: 20px;
    background: transparent;
    color: var(--cyber-text);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-weight: 600;
    text-decoration: none;
}

.filter-btn:hover,
.filter-btn.active {
    background: linear-gradient(135deg, var(--cyber-primary), var(--cyber-accent));
    border-color: transparent;
    color: #000;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 168, 255, 0.3);
    text-decoration: none;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@media (max-width: 768px) {
    .forum-container {
        padding: 0 15px;
    }
    
    .forum-title {
        font-size: 2.2rem;
    }
    
    .story-item {
        padding: 1.5rem;
    }
    
    .story-footer {
        flex-direction: column;
        gap: 1.2rem;
        align-items: flex-start;
    }
    
    .story-stats {
        width: 100%;
        justify-content: space-between;
    }
    
    .filters {
        justify-content: flex-start;
    }
    
    .forum-stats {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .create-story-btn {
        width: 100%;
        justify-content: center;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="forum-container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="forum-header">
        <h1 class="forum-title">üìñ –§–æ—Ä—É–º –∏—Å—Ç–æ—Ä–∏–π</h1>
        <p class="forum-subtitle">–†–µ–∞–ª—å–Ω—ã–µ —Å–ª—É—á–∞–∏ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="forum-stats" id="forumStats">
            <div class="stat-card">
                <span class="stat-number" id="totalStories">0</span>
                <div class="stat-label">üìö –ò—Å—Ç–æ—Ä–∏–π</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="totalComments">0</span>
                <div class="stat-label">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="totalViews">0</span>
                <div class="stat-label">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="storiesToday">0</span>
                <div class="stat-label">üÜï –°–µ–≥–æ–¥–Ω—è</div>
            </div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ -->
    <div style="text-align: center;">
        <a href="{{ url_for('forum.create_story') }}" class="create-story-btn">
            <i class="bi bi-plus-circle"></i> ‚ú® –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∏—Å—Ç–æ—Ä–∏–µ–π
        </a>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class="filters">
        <a href="{{ url_for('forum.forum_home', category='all') }}" 
           class="filter-btn {% if current_category == 'all' %}active{% endif %}">
            üåü –í—Å–µ –∏—Å—Ç–æ—Ä–∏–∏
        </a>
        {% for category in categories %}
        <a href="{{ url_for('forum.forum_home', category=category.id) }}" 
           class="filter-btn {% if current_category == category.id %}active{% endif %}">
            {% if category.id == 'scam' %}üïµÔ∏è {{ category.name }}
            {% elif category.id == 'phishing' %}üé£ {{ category.name }}
            {% elif category.id == 'social' %}üë• {{ category.name }}
            {% else %}üîç {{ category.name }}
            {% endif %} ({{ category.count }})
        </a>
        {% endfor %}
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—Ä–∏–π -->
    <div class="stories-list">
        {% if stories.items %}
            {% for story in stories.items %}
            <div class="story-item" data-story-id="{{ story.id }}">
                <div class="story-meta">
                    <span class="story-category">
                        {% if story.category == 'scam' %}üïµÔ∏è –ú–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ
                        {% elif story.category == 'phishing' %}üé£ –§–∏—à–∏–Ω–≥
                        {% elif story.category == 'social' %}üë• –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∏–Ω–∂–µ–Ω–µ—Ä–∏—è
                        {% else %}üîç –î—Ä—É–≥–∏–µ —Å–ª—É—á–∞–∏
                        {% endif %}
                    </span>
                    <span class="story-date">üìÖ {{ story.created_at.strftime('%d.%m.%Y') }}</span>
                    {% if story.is_featured %}
                    <span style="color: var(--cyber-warning);">‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–∞—è</span>
                    {% endif %}
                </div>
                
                <h3 class="story-title">
                    <a href="{{ url_for('forum.story_detail', story_id=story.id) }}">
                        {{ story.title }}
                    </a>
                </h3>
                
                <div class="story-preview">
                    {{ story.content|truncate(300) }}
                </div>
                
                <div class="story-footer">
                    <div class="story-author">
                        <div class="author-avatar">
                            {{ story.author.username[0]|upper }}
                        </div>
                        {{ story.author.username }}
                    </div>
                    <div class="story-stats">
                        <span class="stat">
                            <i class="bi bi-eye"></i> {{ story.views_count }}
                        </span>
                        <span class="stat">
                            <i class="bi bi-heart"></i> {{ story.likes_count }}
                        </span>
                        <span class="stat">
                            <i class="bi bi-chat"></i> {{ story.comments|length }}
                        </span>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <i class="bi bi-chat-square-text"></i>
                <h3>–ü–æ–∫–∞ –Ω–µ—Ç –∏—Å—Ç–æ—Ä–∏–π</h3>
                <p>–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –ø–æ–¥–µ–ª–∏—Ç—Å—è —Å–≤–æ–∏–º –æ–ø—ã—Ç–æ–º!</p>
                <a href="{{ url_for('forum.create_story') }}" class="create-story-btn">
                    ‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é
                </a>
            </div>
        {% endif %}
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    {% if stories.pages > 1 %}
    <div class="pagination">
        {% if stories.has_prev %}
        <a href="{{ url_for('forum.forum_home', page=stories.prev_num, category=current_category) }}" 
           class="page-link">
            ‚Üê –ù–∞–∑–∞–¥
        </a>
        {% endif %}
        
        {% for page_num in stories.iter_pages() %}
            {% if page_num %}
                <a href="{{ url_for('forum.forum_home', page=page_num, category=current_category) }}" 
                   class="page-link {% if page_num == stories.page %}active{% endif %}">
                    {{ page_num }}
                </a>
            {% endif %}
        {% endfor %}
        
        {% if stories.has_next %}
        <a href="{{ url_for('forum.forum_home', page=stories.next_num, category=current_category) }}" 
           class="page-link">
            –í–ø–µ—Ä–µ–¥ ‚Üí
        </a>
        {% endif %}
    </div>
    {% endif %}

    <!-- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å -->
    {% if current_user.is_authenticated and current_user.is_admin() %}
    <div style="text-align: center; margin-top: 3rem;">
        <a href="{{ url_for('forum.admin_panel') }}" class="create-story-btn" 
           style="background: linear-gradient(135deg, #dc3545, #ff6b6b);">
            <i class="bi bi-shield-check"></i> üõ°Ô∏è –ü–∞–Ω–µ–ª—å –º–æ–¥–µ—Ä–∞—Ü–∏–∏
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
// –£–ª—É—á—à–µ–Ω–Ω—ã–π JavaScript –¥–ª—è —Ñ–æ—Ä—É–º–∞
document.addEventListener('DOMContentLoaded', function() {
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    loadForumStats();
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–π
    animateStories();
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
    addStoryInteractions();
});

// –ê–Ω–∏–º–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–π
function animateStories() {
    const storyItems = document.querySelectorAll('.story-item');
    storyItems.forEach((item, index) => {
        item.style.opacity = '0';
        item.style.transform = 'translateY(30px) scale(0.95)';
        item.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
        
        setTimeout(() => {
            item.style.opacity = '1';
            item.style.transform = 'translateY(0) scale(1)';
        }, index * 100);
    });
}

// –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –∏—Å—Ç–æ—Ä–∏–π
function addStoryInteractions() {
    const storyItems = document.querySelectorAll('.story-item');
    
    storyItems.forEach(item => {
        // –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        const stats = item.querySelectorAll('.stat');
        stats.forEach(stat => {
            stat.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-3px) scale(1.05)';
            });
            
            stat.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) scale(1)';
            });
        });
        
        // –ö–ª–∏–∫ –ø–æ –≤—Å–µ–π –∫–∞—Ä—Ç–æ—á–∫–µ (–∫—Ä–æ–º–µ —Å—Å—ã–ª–æ–∫)
        item.addEventListener('click', function(e) {
            if (!e.target.closest('a') && !e.target.closest('button')) {
                const link = this.querySelector('.story-title a');
                if (link) {
                    link.click();
                }
            }
        });
    });
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
async function loadForumStats() {
    try {
        const response = await fetch('/forum/api/stats');
        const data = await response.json();
        
        // –ê–Ω–∏–º–∏—Ä—É–µ–º —á–∏—Å–ª–∞
        animateNumber('totalStories', data.total_stories || 0);
        animateNumber('totalComments', data.total_comments || 0);
        animateNumber('totalViews', data.total_views || 0);
        animateNumber('storiesToday', data.stories_today || 0);
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
    }
}

// –ê–Ω–∏–º–∞—Ü–∏—è —á–∏—Å–µ–ª
function animateNumber(elementId, targetNumber) {
    const element = document.getElementById(elementId);
    const duration = 2000;
    const steps = 60;
    const step = targetNumber / steps;
    let current = 0;
    
    const timer = setInterval(() => {
        current += step;
        if (current >= targetNumber) {
            current = targetNumber;
            clearInterval(timer);
        }
        element.textContent = Math.floor(current).toLocaleString();
    }, duration / steps);
}

// –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Ö–æ—Ç–∫–µ–∏
document.addEventListener('keydown', function(e) {
    if (e.key === 'n' && (e.ctrlKey || e.metaKey)) {
        e.preventDefault();
        window.location.href = "{{ url_for('forum.create_story') }}";
    }
    
    if (e.key === 'Escape') {
        const activeFilter = document.querySelector('.filter-btn.active');
        if (activeFilter) {
            window.location.href = "{{ url_for('forum.forum_home', category='all') }}";
        }
    }
});

// –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Å–∫—Ä–æ–ª–ª (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
let isLoading = false;
window.addEventListener('scroll', function() {
    if (isLoading) return;
    
    const { scrollTop, scrollHeight, clientHeight } = document.documentElement;
    if (scrollTop + clientHeight >= scrollHeight - 500) {
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Å–ª–µ–¥—É—é—â–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
        console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏—Å—Ç–æ—Ä–∏–π...');
    }
});
</script>
{% endblock %}