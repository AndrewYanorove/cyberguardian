{% extends "base.html" %}

{% block title %}DDoS Attack Simulator - CyberGuardian{% endblock %}

{% block extra_css %}
<style>
.attack-interface {
    border: 2px solid #dc3545;
    border-radius: 15px;
    padding: 2rem;
    margin-bottom: 2rem;
    background: rgba(220, 53, 69, 0.1);
    position: relative;
    overflow: hidden;
}

.attack-interface::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(220, 53, 69, 0.1), transparent);
    animation: interfaceShine 3s infinite;
}

@keyframes interfaceShine {
    0% { left: -100%; }
    100% { left: 100%; }
}

.attack-controls {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin: 2rem 0;
}

.control-group {
    background: rgba(30, 30, 30, 0.8);
    border: 1px solid var(--cyber-border);
    border-radius: 10px;
    padding: 1.5rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.control-group:hover {
    border-color: #dc3545;
    transform: translateY(-2px);
}

.attack-visualization {
    background: rgba(20, 20, 20, 0.9);
    border: 2px solid #dc3545;
    border-radius: 15px;
    padding: 2rem;
    margin: 2rem 0;
    min-height: 400px;
    position: relative;
    overflow: hidden;
}

.network-topology {
    position: relative;
    height: 300px;
    margin: 2rem 0;
}

.botnet-cluster {
    position: absolute;
    left: 5%;
    top: 50%;
    transform: translateY(-50%);
    width: 30%;
}

.bot-node {
    position: absolute;
    width: 12px;
    height: 12px;
    background: #0dcaf0;
    border-radius: 50%;
    animation: nodePulse 2s ease-in-out infinite;
}

.network-line {
    position: absolute;
    height: 2px;
    background: linear-gradient(90deg, #0dcaf0, #dc3545);
    top: 50%;
    left: 35%;
    width: 30%;
}

.target-server {
    position: absolute;
    right: 5%;
    top: 50%;
    transform: translateY(-50%);
    text-align: center;
}

.server-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    animation: serverGlow 2s ease-in-out infinite;
}

.packet {
    position: absolute;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    animation: packetTravel 1.5s linear infinite;
}

@keyframes packetTravel {
    0% { 
        left: 35%; 
        opacity: 0;
        transform: scale(0.5);
    }
    10% { 
        opacity: 1;
        transform: scale(1);
    }
    90% { 
        opacity: 1;
        transform: scale(1);
    }
    100% { 
        left: 65%; 
        opacity: 0;
        transform: scale(0.5);
    }
}

@keyframes nodePulse {
    0%, 100% { 
        transform: scale(1); 
        opacity: 0.7;
        box-shadow: 0 0 10px #0dcaf0;
    }
    50% { 
        transform: scale(1.2); 
        opacity: 1;
        box-shadow: 0 0 20px #0dcaf0;
    }
}

@keyframes serverGlow {
    0%, 100% { 
        text-shadow: 0 0 20px #20c997;
    }
    50% { 
        text-shadow: 0 0 30px #20c997, 0 0 40px #20c997;
    }
}

.attack-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin: 1.5rem 0;
}

.stat-item {
    background: rgba(30, 30, 30, 0.8);
    border: 1px solid var(--cyber-border);
    border-radius: 10px;
    padding: 1rem;
    text-align: center;
    transition: all 0.3s ease;
}

.stat-item:hover {
    border-color: #dc3545;
    transform: translateY(-2px);
}

.warning-banner {
    background: linear-gradient(135deg, #dc3545, #fd7e14);
    border-radius: 10px;
    padding: 1.5rem;
    margin: 2rem 0;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.warning-banner::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
    animation: warningShine 3s linear infinite;
}

@keyframes warningShine {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.attack-progress {
    height: 10px;
    background: rgba(30, 30, 30, 0.8);
    border-radius: 5px;
    overflow: hidden;
    margin: 1rem 0;
    position: relative;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #dc3545, #fd7e14);
    border-radius: 5px;
    transition: width 0.3s ease;
    position: relative;
    overflow: hidden;
}

.progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    animation: progressShine 2s infinite;
}

@keyframes progressShine {
    0% { left: -100%; }
    100% { left: 100%; }
}

.attack-phase {
    display: inline-block;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-weight: bold;
    margin: 0.5rem 0;
    animation: phasePulse 2s ease-in-out infinite;
}

@keyframes phasePulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.live-graph {
    background: rgba(20, 20, 20, 0.8);
    border: 1px solid #333;
    border-radius: 10px;
    padding: 1rem;
    height: 120px;
    margin: 1rem 0;
    position: relative;
    overflow: hidden;
}

.graph-bar {
    position: absolute;
    bottom: 0;
    width: 10px;
    background: linear-gradient(to top, #dc3545, #fd7e14);
    border-radius: 2px 2px 0 0;
    transition: height 0.5s ease;
}
</style>
{% endblock %}

{% block content %}
<div class="container">
    <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ -->
    <div class="warning-banner">
        <h4 class="text-white mb-3">
            <i class="bi bi-exclamation-triangle me-2"></i>
            –£–ß–ï–ë–ù–´–ô –°–ò–ú–£–õ–Ø–¢–û–† DDoS –ê–¢–ê–ö
        </h4>
        <p class="text-white mb-0">
            ‚ö†Ô∏è –≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª–µ–π. 
            –í—Å–µ –∞—Ç–∞–∫–∏ —Å–∏–º—É–ª–∏—Ä—É—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –Ω–µ –Ω–∞–Ω–æ—Å—è—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ —É—â–µ—Ä–±–∞. 
            –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç—Ç–∏—Ö –∑–Ω–∞–Ω–∏–π –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –∞—Ç–∞–∫ –Ω–µ–∑–∞–∫–æ–Ω–Ω–æ!
        </p>
    </div>

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="row mb-5">
        <div class="col-12 text-center">
            <h1 class="cyber-text glow-text mb-3">
                <i class="bi bi-lightning-charge me-2"></i>DDoS Attack Simulator
            </h1>
            <p class="cyber-subtext lead">
                –†–µ–∞–ª—å–Ω–∞—è —Å–∏–º—É–ª—è—Ü–∏—è DDoS –∞—Ç–∞–∫ –≤ –±—Ä–∞—É–∑–µ—Ä–µ —Å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π
            </p>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <!-- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞—Ç–∞–∫–∏ -->
            <div class="attack-interface">
                <h4 class="cyber-text mb-4">
                    <i class="bi bi-play-circle me-2"></i>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—Ç–∞–∫–∏
                </h4>
                
                <div class="attack-controls">
                    <!-- –¶–µ–ª—å –∞—Ç–∞–∫–∏ -->
                    <div class="control-group">
                        <label class="form-label cyber-text">üéØ –¶–µ–ª—å –∞—Ç–∞–∫–∏</label>
                        <select class="form-select cyber-input" id="targetSelect">
                            <option value="example.com">example.com (–£—á–µ–±–Ω—ã–π —Å–µ—Ä–≤–µ—Ä 1)</option>
                            <option value="test-server.org">test-server.org (–£—á–µ–±–Ω—ã–π —Å–µ—Ä–≤–µ—Ä 2)</option>
                            <option value="demo-site.net">demo-site.net (–£—á–µ–±–Ω—ã–π —Å–µ—Ä–≤–µ—Ä 3)</option>
                            <option value="localhost:8080">localhost:8080 (–õ–æ–∫–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç)</option>
                        </select>
                        <small class="cyber-subtext">
                            –¢–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —É—á–µ–±–Ω—ã–µ —Ü–µ–ª–∏
                        </small>
                    </div>

                    <!-- –¢–∏–ø –∞—Ç–∞–∫–∏ -->
                    <div class="control-group">
                        <label class="form-label cyber-text">‚ö° –¢–∏–ø –∞—Ç–∞–∫–∏</label>
                        <select class="form-select cyber-input" id="attackType">
                            <option value="syn_flood">SYN Flood</option>
                            <option value="udp_flood">UDP Flood</option>
                            <option value="http_flood">HTTP Flood</option>
                            <option value="icmp_flood">ICMP Flood</option>
                            <option value="slowloris">Slowloris</option>
                            <option value="dns_amplification">DNS Amplification</option>
                        </select>
                        <small class="cyber-subtext" id="attackDescription">
                            –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π SYN-–ø–∞–∫–µ—Ç–∞–º–∏
                        </small>
                    </div>

                    <!-- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å -->
                    <div class="control-group">
                        <label class="form-label cyber-text">‚è±Ô∏è –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</label>
                        <input type="range" class="form-range" id="durationSlider" min="10" max="300" value="60">
                        <div class="cyber-text text-center" id="durationValue">60 —Å–µ–∫—É–Ω–¥</div>
                    </div>

                    <!-- –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å -->
                    <div class="control-group">
                        <label class="form-label cyber-text">üí• –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å</label>
                        <input type="range" class="form-range" id="intensitySlider" min="1" max="10" value="5">
                        <div class="cyber-text text-center" id="intensityValue">–°—Ä–µ–¥–Ω—è—è (5/10)</div>
                        <small class="cyber-subtext" id="intensityStats">
                            ~250 –ø–∞–∫–µ—Ç–æ–≤/—Å–µ–∫, 50 –ú–±–∏—Ç/—Å
                        </small>
                    </div>
                </div>

                <button onclick="startAttack()" class="btn btn-danger btn-lg w-100 cyber-btn" id="startButton">
                    <i class="bi bi-play-circle me-2"></i>–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Å–∏–º—É–ª—è—Ü–∏—é
                </button>

                <button onclick="stopAttack()" class="btn btn-outline-danger btn-lg w-100 mt-2" id="stopButton" style="display: none;">
                    <i class="bi bi-stop-circle me-2"></i>–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞—Ç–∞–∫—É
                </button>
            </div>

            <!-- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞—Ç–∞–∫–∏ -->
            <div class="attack-visualization" id="attackVisualization" style="display: none;">
                <h4 class="cyber-text mb-4">
                    <i class="bi bi-activity me-2"></i>–ñ–∏–≤–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞—Ç–∞–∫–∏
                </h4>
                
                <!-- –°–µ—Ç–µ–≤–∞—è —Ç–æ–ø–æ–ª–æ–≥–∏—è -->
                <div class="network-topology">
                    <div class="botnet-cluster" id="botnetCluster">
                        <!-- –ë–æ—Ç–Ω–µ—Ç –Ω–æ–¥—ã –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã —á–µ—Ä–µ–∑ JS -->
                    </div>
                    <div class="network-line"></div>
                    <div class="target-server">
                        <div class="server-icon" id="serverIcon">üñ•Ô∏è</div>
                        <h5 class="cyber-text" id="currentTarget">example.com</h5>
                        <p class="cyber-subtext">–°—Ç–∞—Ç—É—Å: <span id="serverStatusText">–û–∂–∏–¥–∞–Ω–∏–µ –∞—Ç–∞–∫–∏</span></p>
                        <div class="attack-phase bg-secondary" id="attackPhase">–û–∂–∏–¥–∞–Ω–∏–µ</div>
                    </div>
                    <!-- –ü–∞–∫–µ—Ç—ã –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã —á–µ—Ä–µ–∑ JS -->
                </div>

                <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –∞—Ç–∞–∫–∏ -->
                <div class="attack-progress">
                    <div class="progress-fill" id="attackProgress" style="width: 0%"></div>
                </div>
                <div class="d-flex justify-content-between cyber-subtext">
                    <span>–ù–∞—á–∞–ª–æ</span>
                    <span id="progressTime">0/60s</span>
                    <span>–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ</span>
                </div>

                <!-- –ì—Ä–∞—Ñ–∏–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ -->
                <div class="live-graph" id="liveGraph">
                    <!-- –ì—Ä–∞—Ñ–∏–∫ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑ JS -->
                </div>

                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞—Ç–∞–∫–∏ -->
                <div class="attack-stats" id="attackStats">
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞—Ç–∞–∫–µ -->
            <div class="cyber-card p-4 mb-4">
                <h4 class="cyber-text mb-3">
                    <i class="bi bi-info-circle me-2"></i>–û —Ç–µ–∫—É—â–µ–π –∞—Ç–∞–∫–µ
                </h4>
                <div id="attackInfo">
                    <p class="cyber-subtext">
                        –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∞—Ç–∞–∫–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏–º—É–ª—è—Ü–∏—é –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ DDoS –∞—Ç–∞–∫.
                    </p>
                </div>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ -->
            <div class="cyber-card p-4 mb-4">
                <h4 class="cyber-text mb-3">
                    <i class="bi bi-graph-up me-2"></i>–ñ–∏–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                </h4>
                <div id="liveStats">
                    <div class="text-center cyber-subtext">
                        –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∞—Ç–∞–∫—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                    </div>
                </div>
            </div>

            <!-- –õ–æ–≥ –∞—Ç–∞–∫–∏ -->
            <div class="cyber-card p-4 mb-4">
                <h4 class="cyber-text mb-3">
                    <i class="bi bi-list-check me-2"></i>–õ–æ–≥ –∞—Ç–∞–∫–∏
                </h4>
                <div id="attackLog" style="max-height: 200px; overflow-y: auto;">
                    <div class="cyber-subtext text-center">–õ–æ–≥ —Å–æ–±—ã—Ç–∏–π –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å</div>
                </div>
            </div>

            <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
            <div class="cyber-card p-4">
                <h4 class="cyber-text mb-3">üöÄ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h4>
                <div class="d-grid gap-2">
                    <a href="{{ url_for('ddos.ddos_education') }}" class="btn btn-outline-warning">
                        <i class="bi bi-book me-2"></i>–û–±—É—á–µ–Ω–∏–µ DDoS
                    </a>
                    <a href="{{ url_for('ddos.protection_guide') }}" class="btn btn-outline-success">
                        <i class="bi bi-shield-check me-2"></i>–ú–µ—Ç–æ–¥—ã –∑–∞—â–∏—Ç—ã
                    </a>
                    <a href="{{ url_for('threats.threat_dashboard') }}" class="btn btn-outline-info">
                        <i class="bi bi-eye me-2"></i>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É–≥—Ä–æ–∑
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—Ç–∞–∫–æ–π
let currentAttackId = null;
let attackInterval = null;
let packetInterval = null;
let graphInterval = null;
let attackStartTime = null;
let totalPacketsSent = 0;
let attackStats = {
    packetsPerSecond: 0,
    bandwidth: 0,
    successRate: 95,
    botnetSize: 0
};

// –û–ø–∏—Å–∞–Ω–∏—è —Ç–∏–ø–æ–≤ –∞—Ç–∞–∫
const attackDescriptions = {
    'syn_flood': '–ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π SYN-–ø–∞–∫–µ—Ç–∞–º–∏. –°–µ—Ä–≤–µ—Ä —Ç—Ä–∞—Ç–∏—Ç —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ –ø–æ–ª—É–æ—Ç–∫—Ä—ã—Ç—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.',
    'udp_flood': '–ú–∞—Å—Å–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ UDP –ø–∞–∫–µ—Ç–æ–≤ –Ω–∞ —Å–ª—É—á–∞–π–Ω—ã–µ –ø–æ—Ä—Ç—ã. –ü–µ—Ä–µ–≥—Ä—É–∂–∞–µ—Ç —Å–µ—Ç–µ–≤—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É.',
    'http_flood': '–ú–Ω–æ–∂–µ—Å—Ç–≤–æ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä—É. –ò–º–∏—Ç–∏—Ä—É–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.',
    'icmp_flood': '–ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ ping-–ø–∞–∫–µ—Ç–∞–º–∏ (ICMP). –ü—Ä–æ—Å—Ç–∞—è –Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –∞—Ç–∞–∫–∞ –Ω–∞ —Å–µ—Ç–µ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å.',
    'slowloris': '–ú–µ–¥–ª–µ–Ω–Ω–∞—è –∞—Ç–∞–∫–∞, –∑–∞–Ω–∏–º–∞—é—â–∞—è –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–µ.',
    'dns_amplification': '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ DNS —Å–µ—Ä–≤–µ—Ä–æ–≤ –¥–ª—è —É—Å–∏–ª–µ–Ω–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ –∞—Ç–∞–∫–∏.'
};

// –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏
const intensitySettings = {
    1: { packets: 50, bandwidth: 10, bots: 100 },
    2: { packets: 100, bandwidth: 20, bots: 200 },
    3: { packets: 150, bandwidth: 30, bots: 300 },
    4: { packets: 200, bandwidth: 40, bots: 400 },
    5: { packets: 250, bandwidth: 50, bots: 500 },
    6: { packets: 350, bandwidth: 70, bots: 700 },
    7: { packets: 500, bandwidth: 100, bots: 1000 },
    8: { packets: 750, bandwidth: 150, bots: 1500 },
    9: { packets: 1000, bandwidth: 200, bots: 2000 },
    10: { packets: 1500, bandwidth: 300, bots: 3000 }
};

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è –∞—Ç–∞–∫–∏
document.getElementById('attackType').addEventListener('change', function() {
    document.getElementById('attackDescription').textContent = attackDescriptions[this.value];
});

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π —Å–ª–∞–π–¥–µ—Ä–æ–≤
document.getElementById('durationSlider').addEventListener('input', function() {
    document.getElementById('durationValue').textContent = this.value + ' —Å–µ–∫—É–Ω–¥';
});

document.getElementById('intensitySlider').addEventListener('input', function() {
    const intensity = parseInt(this.value);
    const intensityLabels = ['–û—á–µ–Ω—å —Å–ª–∞–±–∞—è', '–°–ª–∞–±–∞—è', '–£–º–µ—Ä–µ–Ω–Ω–∞—è', '–°—Ä–µ–¥–Ω—è—è', '–°–∏–ª—å–Ω–∞—è', '–û—á–µ–Ω—å —Å–∏–ª—å–Ω–∞—è', '–≠–∫—Å—Ç—Ä–∏–º', '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è', '–ê–ø–æ–∫–∞–ª–∏–ø—Å–∏—Å', '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è'];
    const settings = intensitySettings[intensity];
    
    document.getElementById('intensityValue').textContent = `${intensityLabels[intensity - 1]} (${intensity}/10)`;
    document.getElementById('intensityStats').textContent = `~${settings.packets} –ø–∞–∫–µ—Ç–æ–≤/—Å–µ–∫, ${settings.bandwidth} –ú–±–∏—Ç/—Å, ${settings.bots} –±–æ—Ç–æ–≤`;
});

// –ó–∞–ø—É—Å–∫ –∞—Ç–∞–∫–∏
async function startAttack() {
    const target = document.getElementById('targetSelect').value;
    const attackType = document.getElementById('attackType').value;
    const duration = parseInt(document.getElementById('durationSlider').value);
    const intensity = parseInt(document.getElementById('intensitySlider').value);
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∞—Ç–∞–∫–∏
    currentAttackId = 'attack_' + Date.now();
    attackStartTime = Date.now();
    totalPacketsSent = 0;
    
    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    const settings = intensitySettings[intensity];
    attackStats.packetsPerSecond = settings.packets;
    attackStats.bandwidth = settings.bandwidth;
    attackStats.botnetSize = settings.bots;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞—Ç–∞–∫–∏
    document.getElementById('attackVisualization').style.display = 'block';
    document.getElementById('startButton').style.display = 'none';
    document.getElementById('stopButton').style.display = 'block';
    document.getElementById('currentTarget').textContent = target;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ –ª–æ–≥
    addToLog('üöÄ –ó–∞–ø—É—Å–∫ —Å–∏–º—É–ª—è—Ü–∏–∏ –∞—Ç–∞–∫–∏...', 'info');
    addToLog(`üéØ –¶–µ–ª—å: ${target}`, 'info');
    addToLog(`‚ö° –¢–∏–ø: ${attackType}`, 'info');
    addToLog(`üí• –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å: ${intensity}/10`, 'info');
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é
    initializeVisualization(intensity);
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∏–º—É–ª—è—Ü–∏—é –∞—Ç–∞–∫–∏
    startAttackSimulation(attackType, intensity, duration);
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    startStatsUpdate();
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
    initializeGraph();
}

// –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞—Ç–∞–∫–∏
function stopAttack() {
    if (attackInterval) {
        clearInterval(attackInterval);
    }
    if (packetInterval) {
        clearInterval(packetInterval);
    }
    if (graphInterval) {
        clearInterval(graphInterval);
    }
    
    // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞—Ç–∞–∫–∏
    document.getElementById('attackVisualization').style.display = 'none';
    document.getElementById('startButton').style.display = 'block';
    document.getElementById('stopButton').style.display = 'none';
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ –ª–æ–≥
    addToLog('üõë –ê—Ç–∞–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º', 'warning');
    addToLog(`üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: ${totalPacketsSent} –ø–∞–∫–µ—Ç–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ`, 'info');
    
    currentAttackId = null;
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
function initializeVisualization(intensity) {
    const botnetCluster = document.getElementById('botnetCluster');
    const settings = intensitySettings[intensity];
    
    // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    botnetCluster.innerHTML = '';
    
    // –°–æ–∑–¥–∞–µ–º –±–æ—Ç–Ω–µ—Ç –Ω–æ–¥—ã (–æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
    const nodeCount = Math.min(50, settings.bots / 20);
    for (let i = 0; i < nodeCount; i++) {
        const node = document.createElement('div');
        node.className = 'bot-node';
        node.style.cssText = `
            top: ${Math.random() * 80 + 10}%;
            left: ${Math.random() * 80 + 10}%;
            animation-delay: ${Math.random() * 2}s;
        `;
        botnetCluster.appendChild(node);
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–∞–∑—É –∞—Ç–∞–∫–∏
    document.getElementById('attackPhase').className = 'attack-phase bg-warning text-dark';
    document.getElementById('attackPhase').textContent = '–ù–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ';
    document.getElementById('serverStatusText').textContent = '–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∞—Ç–∞–∫–∞';
    document.getElementById('serverIcon').textContent = 'üü°';
}

// –ó–∞–ø—É—Å–∫ —Å–∏–º—É–ª—è—Ü–∏–∏ –∞—Ç–∞–∫–∏
function startAttackSimulation(attackType, intensity, duration) {
    const settings = intensitySettings[intensity];
    let elapsedTime = 0;
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É –ø–∞–∫–µ—Ç–æ–≤
    packetInterval = setInterval(() => {
        if (elapsedTime >= duration) {
            stopAttack();
            return;
        }
        
        // –°–∏–º—É–ª–∏—Ä—É–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É –ø–∞–∫–µ—Ç–æ–≤
        const packetsThisSecond = settings.packets + Math.floor(Math.random() * 50) - 25;
        totalPacketsSent += packetsThisSecond;
        
        // –°–æ–∑–¥–∞–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
        createPackets(packetsThisSecond);
        
        elapsedTime++;
        updateProgress(elapsedTime, duration);
        
    }, 1000);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–∞–∂–¥—ã–µ 100–º—Å –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
    attackInterval = setInterval(() => {
        const currentTime = Date.now();
        const timeDiff = (currentTime - attackStartTime) / 1000;
        
        if (timeDiff >= duration) {
            stopAttack();
            return;
        }
        
        // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        updateDynamicStats(timeDiff, duration, settings);
        
    }, 100);
}

// –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
function createPackets(count) {
    const networkTopology = document.querySelector('.network-topology');
    
    for (let i = 0; i < Math.min(count / 10, 20); i++) { // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
        setTimeout(() => {
            const packet = document.createElement('div');
            packet.className = 'packet';
            
            // –°–ª—É—á–∞–π–Ω—ã–π —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∞—Ç–∞–∫–∏
            const colors = {
                'syn_flood': '#dc3545',
                'udp_flood': '#fd7e14', 
                'http_flood': '#ffc107',
                'icmp_flood': '#0dcaf0',
                'slowloris': '#20c997',
                'dns_amplification': '#6f42c1'
            };
            
            const attackType = document.getElementById('attackType').value;
            packet.style.background = colors[attackType] || '#dc3545';
            packet.style.top = `${30 + Math.random() * 40}%`;
            packet.style.animationDelay = `${Math.random() * 0.5}s`;
            
            networkTopology.appendChild(packet);
            
            // –£–¥–∞–ª—è–µ–º –ø–∞–∫–µ—Ç –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(() => {
                if (packet.parentNode) {
                    packet.remove();
                }
            }, 1500);
        }, i * 50);
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
function updateProgress(elapsed, total) {
    const progress = (elapsed / total) * 100;
    document.getElementById('attackProgress').style.width = `${progress}%`;
    document.getElementById('progressTime').textContent = `${elapsed}/${total}s`;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–∞–∑—É –∞—Ç–∞–∫–∏
    const phaseElement = document.getElementById('attackPhase');
    const serverIcon = document.getElementById('serverIcon');
    const statusText = document.getElementById('serverStatusText');
    
    if (progress < 20) {
        phaseElement.className = 'attack-phase bg-warning text-dark';
        phaseElement.textContent = '–ù–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ';
        serverIcon.textContent = 'üü°';
        statusText.textContent = '–ü–æ–≤—ã—à–µ–Ω–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞';
    } else if (progress < 60) {
        phaseElement.className = 'attack-phase bg-danger text-white';
        phaseElement.textContent = '–ü–∏–∫–æ–≤–∞—è –∞—Ç–∞–∫–∞';
        serverIcon.textContent = 'üî¥';
        statusText.textContent = '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞';
    } else {
        phaseElement.className = 'attack-phase bg-orange text-white';
        phaseElement.textContent = '–°–Ω–∏–∂–µ–Ω–∏–µ';
        serverIcon.textContent = 'üü†';
        statusText.textContent = '–í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞';
    }
}

// –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
function updateDynamicStats(elapsed, total, settings) {
    const progress = elapsed / total;
    
    // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑–º–µ–Ω—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏
    let currentPPS = settings.packets;
    let currentBandwidth = settings.bandwidth;
    
    if (progress < 0.2) {
        // –§–∞–∑–∞ –Ω–∞—Ä–∞—â–∏–≤–∞–Ω–∏—è
        currentPPS = Math.floor(settings.packets * (progress / 0.2));
        currentBandwidth = Math.floor(settings.bandwidth * (progress / 0.2));
    } else if (progress > 0.8) {
        // –§–∞–∑–∞ —Å–Ω–∏–∂–µ–Ω–∏—è
        currentPPS = Math.floor(settings.packets * ((1 - progress) / 0.2));
        currentBandwidth = Math.floor(settings.bandwidth * ((1 - progress) / 0.2));
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    attackStats.packetsPerSecond = currentPPS;
    attackStats.bandwidth = currentBandwidth;
    attackStats.successRate = 95 - Math.floor(progress * 10);
    
    updateStatsDisplay();
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
function updateStatsDisplay() {
    document.getElementById('attackStats').innerHTML = `
        <div class="stat-item">
            <div class="cyber-text">${attackStats.packetsPerSecond}/s</div>
            <small class="cyber-subtext">–ü–∞–∫–µ—Ç–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É</small>
        </div>
        <div class="stat-item">
            <div class="cyber-text">${attackStats.bandwidth} –ú–±–∏—Ç/—Å</div>
            <small class="cyber-subtext">–°–∫–æ—Ä–æ—Å—Ç—å —Ç—Ä–∞—Ñ–∏–∫–∞</small>
        </div>
        <div class="stat-item">
            <div class="cyber-text">${attackStats.successRate}%</div>
            <small class="cyber-subtext">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</small>
        </div>
        <div class="stat-item">
            <div class="cyber-text">${attackStats.botnetSize}</div>
            <small class="cyber-subtext">–†–∞–∑–º–µ—Ä –±–æ—Ç–Ω–µ—Ç–∞</small>
        </div>
    `;
    
    document.getElementById('liveStats').innerHTML = `
        <div class="cyber-text h4">${totalPacketsSent.toLocaleString()}</div>
        <small class="cyber-subtext">–í—Å–µ–≥–æ –ø–∞–∫–µ—Ç–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</small>
        <div class="mt-3">
            <small class="cyber-subtext d-block">üìä –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: –í—ã—Å–æ–∫–∞—è</small>
            <small class="cyber-subtext d-block">‚è±Ô∏è –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${Math.floor((Date.now() - attackStartTime) / 1000)}—Å</small>
            <small class="cyber-subtext d-block">üéØ –¶–µ–ª—å: ${document.getElementById('targetSelect').value}</small>
        </div>
    `;
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
function initializeGraph() {
    const graph = document.getElementById('liveGraph');
    graph.innerHTML = '';
    
    // –°–æ–∑–¥–∞–µ–º 20 —Å—Ç–æ–ª–±—Ü–æ–≤ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
    for (let i = 0; i < 20; i++) {
        const bar = document.createElement('div');
        bar.className = 'graph-bar';
        bar.style.left = `${i * 5}%`;
        bar.style.height = '0%';
        graph.appendChild(bar);
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫
    let barIndex = 0;
    graphInterval = setInterval(() => {
        const bars = graph.querySelectorAll('.graph-bar');
        const height = 20 + (attackStats.packetsPerSecond / intensitySettings[10].packets) * 80;
        
        bars[barIndex].style.height = `${height}%`;
        barIndex = (barIndex + 1) % bars.length;
    }, 500);
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥
function addToLog(message, type = 'info') {
    const log = document.getElementById('attackLog');
    const timestamp = new Date().toLocaleTimeString();
    
    const logEntry = document.createElement('div');
    logEntry.className = `small mb-1 ${type === 'info' ? 'text-info' : type === 'warning' ? 'text-warning' : 'text-danger'}`;
    logEntry.innerHTML = `<span class="text-muted">[${timestamp}]</span> ${message}`;
    
    log.appendChild(logEntry);
    log.scrollTop = log.scrollHeight;
    
    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ –ª–æ–≥–µ
    if (log.children.length > 50) {
        log.removeChild(log.firstChild);
    }
}

// –ó–∞–ø—É—Å–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
function startStatsUpdate() {
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ updateDynamicStats
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
    document.getElementById('attackDescription').textContent = attackDescriptions['syn_flood'];
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏
    const intensity = parseInt(document.getElementById('intensitySlider').value);
    const settings = intensitySettings[intensity];
    document.getElementById('intensityStats').textContent = `~${settings.packets} –ø–∞–∫–µ—Ç–æ–≤/—Å–µ–∫, ${settings.bandwidth} –ú–±–∏—Ç/—Å, ${settings.bots} –±–æ—Ç–æ–≤`;
});
</script>
{% endblock %}